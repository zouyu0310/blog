---
title: 工时计算
date: 2023年7月3日10:00:27
---



---



-- 24h办结率：从接单到处理完毕用时24h以内的总工单量/总接单量
-- 响应率：从工单发起到接单用时30min以内的总工单量/总接单量
-- 满意度：当月回访工单的实际分数合计/当月回访工单的饱和分数



1. 30分钟到达率概念和公式
2. 这几个率的时间按工单提报时间还是操作节点的插入时间
3. 满意度计算中未回访的工单是否统计
4. 工单量概念: 是否为已接单 (包含未处理和已处理完成)





格式:

| 姓名 | 工单量 | 24h办结率 | 30分钟到达率 | 15分钟响应率 | 满意度 |
| ---- | ------ | --------- | ------------ | ------------ | ------ |
|      |        |           |              |              |        |



SQL:

```
-- 计算响应率
SELECT
operator,
    COUNT(*) AS detail_count,
    SUM(CASE WHEN difftime <= 15 THEN 1 ELSE 0 END) AS diff_count,
    ROUND(SUM(CASE WHEN difftime <= 15 THEN 1 ELSE 0 END) / COUNT(*), 2) AS ratio
FROM (
    SELECT DISTINCT
        t1.operator,
        t1.gd_code,
        t1.id,
        t1.operate_time,
        t2.id id2,
        t2.operate_time operate_time2,
        round((
                SUM( IFNULL( unix_timestamp( t1.operate_time ), 0 ) ) - SUM( IFNULL( unix_timestamp( t2.operate_time ), 0 ) ) 
                ) / 60,
            2 
        ) difftime 
    FROM
        work_activity t1
        LEFT JOIN work_activity t2 ON t1.gd_code = t2.gd_code
        LEFT JOIN work_list a ON t1.gd_code = a.gd_code
        LEFT JOIN basic_room AS b ON a.r_id = b.r_id 
    WHERE
        t1.curr_node = 'gd_node_reception'
        AND t2.curr_node = 'gd_node_accept' 
        AND t1.id > t2.id 
        AND a.inserttime >= '2022-06-08' 
        AND a.inserttime <= '2023-07-01' 
        AND a.a_id IN ( 'aa4bd0d084bc45119ffe371107e513f1' ) 
    GROUP BY
        a.gd_code 
) subq
 GROUP BY
        operator;
```



````
-- 计算 24h办结率
SELECT
	operator,
	COUNT(*) AS detail_count,
	SUM( CASE WHEN difftime <= 24 THEN 1 ELSE 0 END ) AS diff_count,
	ROUND( SUM( CASE WHEN difftime <= 24 THEN 1 ELSE 0 END ) / COUNT(*), 2 ) AS ratio 
FROM
	(
	SELECT DISTINCT
		t1.operator,
		t1.gd_code,
		t1.id,
		t1.operate_time,
		t2.id id2,
		t2.operate_time operate_time2,
		round((
				SUM( IFNULL( unix_timestamp( t1.operate_time ), 0 ) ) - SUM( IFNULL( unix_timestamp( t2.operate_time ), 0 ) ) 
				
				 - (
					SUM( IFNULL( unix_timestamp( tt5.operate_time ), 0 ) ) - SUM( IFNULL( unix_timestamp( tt4.operate_time ), 0 ) ) 
				)
				
				) / 60 / 60,
			2 
		) difftime 
	FROM
		work_activity t1
		LEFT JOIN work_activity t2 ON t1.gd_code = t2.gd_code
		LEFT JOIN work_list a ON t1.gd_code = a.gd_code
		LEFT JOIN basic_room AS b ON a.r_id = b.r_id 
		LEFT JOIN work_activity tt5 ON tt5.gd_code = t1.gd_code 
		AND tt5.curr_node = 'gd_node_active'
		LEFT JOIN work_activity tt4 ON tt4.gd_code = t1.gd_code 
		AND tt4.curr_node = 'gd_node_pause'
	WHERE
		t1.curr_node = 'gd_node_finish' -- 			已接单
		
		AND t2.curr_node = 'gd_node_reception' 
		AND t1.id > t2.id 
		AND a.inserttime >= '2022-06-08' 
		AND a.inserttime <= '2023-07-01' 
		AND a.a_id IN ( 'aa4bd0d084bc45119ffe371107e513f1' ) 
	GROUP BY
	a.gd_code 
	) subq
````



```
-- 工单数
	

select count(1),uid from (


SELECT
	t1.*,tbu.uid
FROM
	work_activity t1
	left JOIN work_list t2 on t1.gd_code=t2.gd_code
	LEFT JOIN sys_user tbu ON tbu.username = t1.jdr 

WHERE
	 t1.jdr = '邹宇' 
	AND t1.curr_node IN ( 'gd_node_finish', 'gd_node_handle', 'gd_node_reception' ) 
	AND t2.inserttime >= '2022-05-19' 
	AND t2.inserttime <= '2023-07-14' 
GROUP BY
	 t1.gd_code


) tt1
GROUP BY uid
```





```
-- 满意度
SELECT
	uid,
	COUNT(*) AS detail_count,
	SUM(count ) AS diff_count,
	ROUND( 	SUM(count ) / (COUNT(*) *5), 2 ) AS ratio 
FROM
	(
	SELECT DISTINCT
	t1.id,
	t1.gd_code,
	t1.operate_time,
	t2.id id2,
	ti.count,
	ti.inserttime operate_time2,
	tbu.uid 
FROM
	work_activity t1
	LEFT JOIN work_activity t2 ON t1.gd_code = t2.gd_code
	LEFT JOIN work_list a ON t1.gd_code = a.gd_code 
	AND a.if_backvisit = '1' 
	AND a.if_backvisit_again = '1'
	LEFT JOIN work_interview ti ON t1.gd_code = ti.gd_code
	LEFT JOIN basic_room AS b ON a.r_id = b.r_id
	LEFT JOIN work_activity wa3 ON a.gd_code = wa3.gd_code 
	AND wa3.curr_node = 'gd_node_reception'
	LEFT JOIN sys_user tbu ON tbu.username = wa3.jdr 
WHERE
	t1.id >= t2.id 
	AND LENGTH(
	ifnull( xj_plan_id, 0 )) != 32 
	AND a.inserttime >= '2022-05-19' 
	AND a.inserttime <= '2023-07-14' 
	AND a.a_id IN ( 'aa4bd0d084bc45119ffe371107e513f1' ) 
	AND wa3.jdr = '邹宇' 
GROUP BY
	a.gd_code 
ORDER BY
	t1.id,
	t2.id DESC
	) subq
GROUP BY uid


```







```
-- 30分钟到达率
SELECT
	u_id,
	COUNT(*) AS detail_count,
	SUM( CASE WHEN difftime <= 30 THEN 1 ELSE 0 END ) AS diff_count,
	ROUND( SUM( CASE WHEN difftime <= 30 THEN 1 ELSE 0 END ) / COUNT(*), 2 ) AS ratio 
FROM
	(
	SELECT DISTINCT
		t1.operator u_id,
		t1.gd_code,
		t1.id,
		t1.operate_time,
		t2.id id2,
		t2.operate_time operate_time2,
		round((
				SUM( IFNULL( unix_timestamp( t1.operate_time ), 0 ) ) - SUM( IFNULL( unix_timestamp( t2.operate_time ), 0 ) ) 
				) / 60,
			2 
		) difftime 
	FROM
		work_activity t1
		LEFT JOIN work_activity t2 ON t1.gd_code = t2.gd_code
		LEFT JOIN work_list a ON t1.gd_code = a.gd_code
		LEFT JOIN basic_room AS b ON a.r_id = b.r_id 
		WHERE-- 		gd_node_daoda
		t1.curr_node = 'gd_node_daoda' 
		AND t2.curr_node = 'gd_node_reception' 
		AND t1.id > t2.id 
		AND a.inserttime >= '2022-06-08' 
		AND a.inserttime <= '2023-07-01' 
		AND a.a_id IN ( 'aa4bd0d084bc45119ffe371107e513f1' ) 
	GROUP BY
		a.gd_code 
	) subq 
GROUP BY
	u_id
```

