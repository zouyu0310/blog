---
title: 公众号消息推送
date: 2023-3-16 10:02:21
---



## 申请模板

登录公众号后台 -- 模板消息 选择适应模板

如: 模板ID VM1jSUKfRhNcU2h6UrW7qIkNkUVa-EenW9hDtV-Kde0   (开发者调用模板消息接口时需提供模板ID)


```

标题 余额不足提醒
行业 房地产 - 物业
详细内容
{{first.DATA}}
账户余额：{{keyword1.DATA}}
时间：{{keyword2.DATA}}
{{remark.DATA}}
在发送时，需要将内容中的参数（{{.DATA}}内为参数）赋值替换为需要的信息
```

模板样式: 

```
您的余额不足，无法在线支付停车费
账户余额：3元
时间：2014年7月21日 18:36
如有疑问请在微信中回复9
详情
```





## 代码实现





```java
    /**
     * 发送仪表余量模板消息
     * @param openidTest
     * @param accessToken
     * @param usablemoney
     * @param templateid
     * @param r_fullname
     * @param openid
     * @throws IOException
     */
    @Override
    @Async("customAsyncThreadPool")//指定使用哪个线程池配置
    public void sendMsg(String openidTest, String accessToken, BigDecimal usablemoney, String templateid, String r_fullname, String openid) throws IOException {
        String message = null;

        String messageUrl = "https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=" + accessToken;
        Map<String, Object> data = new HashMap<>();
        TemplateData first = new TemplateData();
        first.setValue("亲爱的业主，您的房间（" + r_fullname + "）当前电费账户余额不足，希望您尽快充值!");
        data.put("first", first);
        TemplateData keyword1 = new TemplateData();
        keyword1.setValue(usablemoney.toString());
        data.put("keyword1", keyword1);
        TemplateData keyword2 = new TemplateData();
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        String date = sdf.format(new Date());
        keyword2.setValue(date);
        data.put("keyword2", keyword2);
        TemplateData keyword3 = new TemplateData();
        keyword3.setValue("感谢您的使用");
        data.put("remark", keyword3);

        JSONObject json = new JSONObject();
        json.put("touser", openid);//设置openid
        json.put("touser", openidTest);//设置openid
        json.put("template_id", templateid);//设置模板id
        json.put("data", data);//设置模板消息内容
        PrintWriter out = null;
        URL url = new URL(messageUrl);
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestMethod("POST");
        connection.setDoOutput(true);
        connection.setDoInput(true);
        // 获取URLConnection对象对应的输出流（设置请求编码为UTF-8）
        out = new PrintWriter(new OutputStreamWriter(connection.getOutputStream(), "UTF-8"));
        // 发送请求参数
        out.print(json);
        out.flush();
        connection.connect();
        //获取返回的字符
        InputStream inputStream = connection.getInputStream();
        int size = inputStream.available();
        byte[] bs = new byte[size];
        inputStream.read(bs);
        message = new String(bs, "UTF-8");
        log.info("公众号平台结果:{}",message);
    }
```

