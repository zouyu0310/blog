(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{816:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"从零开始用jenkins自动构建部署springboot项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从零开始用jenkins自动构建部署springboot项目"}},[t._v("#")]),t._v(" 从零开始用Jenkins自动构建部署SpringBoot项目")]),t._v(" "),s("h2",{attrs:{id:"前提条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[t._v("#")]),t._v(" 前提条件")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("一台服务器")]),t._v(" "),s("p",[t._v("建议配置2h4g以上（1h2g的属实有点低了）")])]),t._v(" "),s("li",[s("p",[t._v("sspringboot项目手动用maven打包，且jar包可正常运行")]),t._v(" "),s("p",[t._v("如果你的是多模块项目（如图），需要配置好打包，否则启动失败")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210916125322578.png",alt:"image-20210916125322578"}})]),t._v(" "),s("p",[t._v("就像这样的项目，可浏览文章："),s("a",{attrs:{href:"https://blog.csdn.net/A_zhiyuan/article/details/120326653",target:"_blank",rel:"noopener noreferrer"}},[t._v("SpringBoot多模块打包方式"),s("OutboundLink")],1)])])]),t._v(" "),s("h2",{attrs:{id:"安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins"}},[t._v("#")]),t._v(" 安装Jenkins")]),t._v(" "),s("p",[t._v("安装教程可看视频：https://www.bilibili.com/video/BV1wA411c7aS")]),t._v(" "),s("p",[s("strong",[t._v("1、安装")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull jenkins/jenkins:lts\n")])])]),s("p",[s("strong",[t._v("2、创建目录")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir jenkins_home")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("  jenkins_home\n")])])]),s("p",[s("strong",[t._v("3、启动")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-di")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("jenkins "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /data/jenkins_home:/var/jenkins_home jenkins/jenkins:lts\n")])])]),s("p",[t._v("启动失败：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker logs  d6b5baf89d6b")]),t._v("\ntouch: cannot "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/var/jenkins_home/copy_reference_file.log'")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Permission denied\nCan not "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?\ntouch: cannot "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/var/jenkins_home/copy_reference_file.log'")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Permission denied\nCan not "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?\n")])])]),s("p",[t._v("权限：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-R")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" /data/jenkins_home\n")])])]),s("p",[t._v("再重新启动，等启动工作完毕后")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914190950830.png",alt:"image-20210914190950830"}})]),t._v(" "),s("p",[t._v("查看容器日志：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs jenkins\n")])])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914191244184.png",alt:"image-20210914191244184"}})]),t._v(" "),s("p",[t._v("箭头所指就是密码")]),t._v(" "),s("blockquote",[s("p",[t._v("方法二：")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd jenkins_home/secrets/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost secrets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" www www  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 filepath-filters.d\n-rw-r----- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" www www  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 initialAdminPassword\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" www www  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 jenkins.model.Jenkins.crumbSalt\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" www www "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 master.key\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" www www "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("272")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 org.jenkinsci.main.modules.instance_identity.InstanceIdentity.KEY\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" www www   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 slave-to-master-security-kill-switch\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" www www  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":45 whitelisted-callables.d\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost secrets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat initialAdminPassword")]),t._v("\n730edbb8adcd4ae7b58f14ac3ccd001d\n")])])]),s("p",[t._v("Jenkins修改初始密码:"),s("a",{attrs:{href:"https://www.pianshen.com/article/7582333512/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.pianshen.com/article/7582333512/"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("5、进入页面后，选择推荐的插件")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914191628179.png",alt:"image-20210914191628179"}})]),t._v(" "),s("p",[t._v("全部安装成功后：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914191921616.png",alt:"image-20210914191921616"}})]),t._v(" "),s("p",[t._v("有一些会安装失败（我用的服务器，用虚拟机的由于有墙可能访问不到github）")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192005987.png",alt:"image-20210914192005987"}})]),t._v(" "),s("p",[t._v("点击重试后")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192029111.png",alt:"image-20210914192029111"}})]),t._v(" "),s("p",[t._v("大部分都装上了，有几个可能会装不上，到时候可以手动安装，先点确定")]),t._v(" "),s("p",[t._v("然后创建用户")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192137056.png",alt:"image-20210914192137056"}})]),t._v(" "),s("p",[t._v("下一步，URL为，jenkins的IP:端口")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192206581.png",alt:"image-20210914192206581"}})]),t._v(" "),s("h2",{attrs:{id:"插件安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件安装"}},[t._v("#")]),t._v(" 插件安装")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192444240.png",alt:"image-20210914192444240"}})]),t._v(" "),s("p",[t._v("搜索插件 ssh（红色代表与jenkins版本不匹配）")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192559032.png",alt:"image-20210914192559032"}})]),t._v(" "),s("p",[t._v("安装失败重新安装即可！\n"),s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914192746394.png",alt:"image-20210914192746394"}})]),t._v(" "),s("p",[t._v("第一行表示之前的安装的日志，等图标变成蓝色代表安装成功")]),t._v(" "),s("h2",{attrs:{id:"安装jdk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk"}},[t._v("#")]),t._v(" 安装jdk")]),t._v(" "),s("p",[t._v("全局工具配置")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914194021666.png",alt:"image-20210914194021666"}})]),t._v(" "),s("p",[t._v("点新增JDK，选择版本，登录下oracle账号：2696671285@qq.com Oracle123")]),t._v(" "),s("p",[t._v("账号为up主提供的：https://www.bilibili.com/video/BV1wA411c7aS")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914194420749.png",alt:"image-20210914194420749"}})]),t._v(" "),s("p",[t._v("之后安装maven（如果你的项目不是maven则安装别的插件）")]),t._v(" "),s("h2",{attrs:{id:"安装maven"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装maven"}},[t._v("#")]),t._v(" 安装maven")]),t._v(" "),s("p",[t._v("点击保存")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914195019228.png",alt:"image-20210914195019228"}})]),t._v(" "),s("h2",{attrs:{id:"配置ssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置ssh"}},[t._v("#")]),t._v(" 配置ssh")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914195127408.png",alt:"image-20210914195127408"}})]),t._v(" "),s("p",[t._v("搜索 ssh")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914195210660.png",alt:"image-20210914195210660"}})]),t._v(" "),s("p",[t._v("添加ssh的ip和端口 ， 点击添加")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914200115406.png",alt:"image-20210914200115406"}})]),t._v(" "),s("p",[t._v("添加服务器的账号和密码")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914200334869.png",alt:"image-20210914200334869"}})]),t._v(" "),s("p",[t._v("检测连接是否成功")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210914201739436.png",alt:"image-20210914201739436"}})]),t._v(" "),s("h2",{attrs:{id:"构建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建项目"}},[t._v("#")]),t._v(" 构建项目")]),t._v(" "),s("p",[s("strong",[t._v("1、新建项目")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915083151955.png",alt:"image-20210915083151955"}})]),t._v(" "),s("p",[s("strong",[t._v("2、输入任务名称，选择maven")])]),t._v(" "),s("p",[t._v("没有这个项目则下载maven插件（百度即可）")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://plugins.jenkins.io/maven-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("Maven Integration plugin"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915083215160.png",alt:"image-20210915083215160"}})]),t._v(" "),s("p",[s("strong",[t._v("3、设置源码管理")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915083258091.png",alt:"image-20210915083258091"}})]),t._v(" "),s("p",[t._v("记得添加你的gitee账号密码的凭据")]),t._v(" "),s("p",[s("strong",[t._v("4、设置Maven")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915094404192.png",alt:"image-20210915094404192"}})]),t._v(" "),s("p",[t._v("设置")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("clean package\n")])])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915083519329.png",alt:"image-20210915083519329"}})]),t._v(" "),s("p",[t._v("然后我们先构建下，等待结束")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915083658318.png",alt:"image-20210915083658318"}})]),t._v(" "),s("p",[t._v("但是maven下载依赖速度太慢，我们可以手动关闭构建，把镜像配置为阿里云镜像")]),t._v(" "),s("p",[s("strong",[t._v("5、修改maven配置")])]),t._v(" "),s("p",[t._v("配置文件在你的jenkins数据目录下，例如我的就是：")]),t._v(" "),s("p",[s("code",[t._v("/data/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation")])]),t._v(" "),s("p",[t._v("按照原先方法修改配置文件，把maven远程仓库地址改成阿里云的，这步就不用详细说了吧。")]),t._v(" "),s("p",[s("strong",[t._v("6、重新构建")])]),t._v(" "),s("p",[t._v("点击 立即构建")]),t._v(" "),s("p",[t._v("这次下载速度就快了，构建好的jar包目录在：")]),t._v(" "),s("p",[s("code",[t._v("/data/jenkins_home/workspace/jekins-test/service/target")])]),t._v(" "),s("p",[t._v("jekins-test：是任务名称（我创建任务时，少打了个n）")]),t._v(" "),s("p",[t._v("选中查看控制台输出")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915084209903.png",alt:"image-20210915084209903"}})]),t._v(" "),s("p",[t._v("根据输出就能看到jar的生成目录")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915004357100.png",alt:"image-20210915004357100"}})]),t._v(" "),s("p",[t._v("然后我们启动看看是否正常")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /data/jenkins_home/workspace/jekins-test/service/target\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" service-0.0.1-SNAPSHOT.jar "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /data/journalism/logs.txt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n")])])]),s("h2",{attrs:{id:"构建后自动部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建后自动部署"}},[t._v("#")]),t._v(" 构建后自动部署")]),t._v(" "),s("p",[t._v("8160是我的springboot服务端口")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v("  -nlp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8160")]),t._v("\n")])])]),s("p",[t._v("强制杀死某个端口进程命令，关闭jar包")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fuser")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-k")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" tcp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8160")]),t._v("\n")])])]),s("p",[t._v("请先把刚才开启的jar包服务关掉")]),t._v(" "),s("p",[t._v("设置"),s("strong",[t._v("构建环境")]),t._v("配置，构建后操作（构建前就不用设置，测试过，填了就出现错误）")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915131245249.png",alt:"image-20210915131245249"}})]),t._v(" "),s("h2",{attrs:{id:"git提交后自动构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#git提交后自动构建"}},[t._v("#")]),t._v(" Git提交后自动构建")]),t._v(" "),s("p",[s("strong",[t._v("1、配置URL构建触发器")])]),t._v(" "),s("p",[t._v("令牌随便输，URL格式就是下面那个英文说明，根据自己的修改")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915101109152.png",alt:"image-20210915101109152"}})]),t._v(" "),s("p",[s("strong",[t._v("2、配置Gitee的WebHooks")])]),t._v(" "),s("p",[t._v("我这里用的Gitee（学校网进GitHub很不稳定，就选择Gitee了）")]),t._v(" "),s("p",[t._v("Gitee项目里设置URL和秘钥")]),t._v(" "),s("p",[t._v("为了安全自己写个服务用来访问触发Jenkins构建的URL，不直接输入之前的URL")]),t._v(" "),s("p",[t._v("例如：我用的php，代码在下方")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915101405242.png",alt:"image-20210915101405242"}})]),t._v(" "),s("p",[s("strong",[t._v("3、添加用户token")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915114229936.png",alt:"image-20210915114229936"}})]),t._v(" "),s("p",[t._v("生成，保存token信息")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915114258223.png",alt:"image-20210915114258223"}})]),t._v(" "),s("p",[t._v("修改url，例如我的，根据自己规则设置")]),t._v(" "),s("p",[s("code",[t._v("http://用户名:token@ip:端口/job/jekins-test/build?token=设置的token")])]),t._v(" "),s("p",[t._v("详情访问："),s("a",{attrs:{href:"https://www.cnblogs.com/tyrionyang/p/8183819.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过URL触发Jenkins构建"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("php代码如下（修改URL和秘钥）：")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//接收头信息")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("em_getallheaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_SERVER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'HTTP_'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("str_replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'-'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ucwords")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("strtolower")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("str_replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'_'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//发送请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("getSslPage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_SSL_VERIFYPEER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("FALSE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_HEADER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_FOLLOWLOCATION")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_REFERER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_RETURNTRANSFER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("TRUE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$result")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_exec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$result")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"你的URL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$headers")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("em_getallheaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//是否等于Gitee设置的秘钥")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'X-Gitee-Token'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"你设置的秘钥"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSslPage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"ok"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"no"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print_r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'X-Gitee-Token'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),s("p",[s("strong",[t._v("4、完成测试")])]),t._v(" "),s("p",[t._v("更改代码，push到Gitee")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915132358946.png",alt:"image-20210915132358946"}})]),t._v(" "),s("p",[t._v("Gitee请求成功")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915132137715.png",alt:"image-20210915132137715"}})]),t._v(" "),s("p",[t._v("jenkins构建成功")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oddfar/static/img/jenkins/image-20210915132258799.png",alt:"image-20210915132258799"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);