(window.webpackJsonp=window.webpackJsonp||[]).push([[422],{1049:function(t,a,e){"use strict";e.r(a);var s=e(14),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"一、spring-boot-actuator简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、spring-boot-actuator简介"}},[t._v("#")]),t._v(" 一、Spring Boot Actuator简介")]),t._v(" "),a("p",[t._v("Spring Boot作为构建微服务节点的方案，一定要提供全面而且细致的监控指标，使微服务更易于管理！微服务不同于单体应用，微服务的每个服务节点都单独部署，独立运行，大型的微服务项目甚至有成百上千个服务节点。这就为我们进行系统监控与运维提出了挑战。为了应对这个挑战，其中最重要的工作之一就是：微服务节点能够合理的暴露服务的相关监控指标，用以对服务进行健康检查、监控管理，从而进行合理的流量规划与安排系统运维工作！\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/krislinzhao/IMGcloud/img/20200507123616.png",alt:""}})]),t._v(" "),a("p",[t._v("Spring Boot Actuator 可以监控我们的应用程序，收集流量和数据库状态、健康状态等监控指标。在生产环境中，我们可以方便的通过HTTP请求获取应用的状态信息，以JSON格式数据响应。\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/krislinzhao/IMGcloud/img/20200507123713.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("Spring Boot Actuator监控端点的分类")])]),t._v(" "),a("ul",[a("li",[t._v("静态配置类：主要是一些静态配置信息，比如： Spring Bean 加载信息、yml 或properties配置信息、环境变量信息、请求接口关系映射信息等；")]),t._v(" "),a("li",[t._v("动态指标类：主要用于展现程序运行期状态，例如内存堆栈信息、请求链信息、健康指标信息等；")]),t._v(" "),a("li",[t._v("操作控制类：主要是shutdown功能，用户可以远程发送HTTP请求，从而关闭监控功能。")])]),t._v(" "),a("h1",{attrs:{id:"二、actuator开启与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、actuator开启与配置"}},[t._v("#")]),t._v(" 二、Actuator开启与配置")]),t._v(" "),a("p",[t._v("在Spring Boot2.x项目中开启Actuator非常简单，只需要引入如下的mavn坐标即可。")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-actuator"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("Spring Boot Actuator启用之后默认开放了两个端点的访问：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("/actuator/health")]),t._v("用以监控应用状态。返回值是应用状态信息，包含四种状态DOWN(应用不正常), OUT_OF_SERVICE(服务不可用),UP(状态正常), UNKNOWN(状态未知)。如果服务状态正常，我们访问"),a("code",[t._v("http:/lhost:port/actuator/health")]),t._v("得到如下响应信息：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n    "status" : "UP"\n}\n')])])]),a("ul",[a("li",[a("code",[t._v("/actuator/info")]),t._v(" 用来响应应用相关信息，默认为空。可以根据我们自己的需要，向服务调用者暴露相关信息。如下所示,配置属性可以随意起名，但都要挂在info下面：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("info.app-name=spring-boot-actuator-demo\ninfo.description=spring-boot-actuator-demo indexs monitor \n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/krislinzhao/IMGcloud/img/20200507123907.png",alt:""}})]),t._v(" "),a("p",[t._v("如果我们希望开放更多的监控端点给服务调用者，需要配置："),a("strong",[t._v("开放部分监控端点")]),t._v("，端点名称用逗号分隔")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoints.web.exposure.exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("beans,env")]),t._v("\n")])])]),a("p",[a("strong",[t._v("开放所有监控端点:")])]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoints.web.exposure.include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("*")]),t._v("\n")])])]),a("p",[t._v("星号在YAML配置文件中中有特殊的含义，所以使用YAML配置文件一定要加引号，如下所示：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("management")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exposure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n")])])]),a("h1",{attrs:{id:"三、常用监控端点说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、常用监控端点说明"}},[t._v("#")]),t._v(" 三、常用监控端点说明")]),t._v(" "),a("p",[t._v("注意下图中的服务启用，不等于对外开放访问。对外开放访问的服务端点一定要先开启服务。如果服务不是默认开启的，使用如下方式开启:")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shutdown是服务端点名称，可以替换")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("management.endpoint.shutdown.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("ID")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("服务是否默认启用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("auditevents")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("应用程序的审计事件相关信息")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("beans")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("应用中所有Spring Beans的完整列表")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("conditions")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("（configuration and auto-configuration classes）的状态及它们被应用或未被应用的原因")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("configprops")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("@ConfigurationProperties")]),t._v("的集合列表")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("env")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Spring的 "),a("code",[t._v("ConfigurableEnvironment")]),t._v("的属性")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("flyway")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("flyway 数据库迁移路径，如果有的话")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("liquibase")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Liquibase数据库迁移路径，如果有的话")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("metrics")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("应用的"),a("code",[t._v("metrics")]),t._v("指标信息")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("mappings")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("所有"),a("code",[t._v("@RequestMapping")]),t._v("路径的集合列表")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("scheduledtasks")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("应用程序中的"),a("code",[t._v("计划任务")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sessions")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("允许从Spring会话支持的会话存储中检索和删除(retrieval and deletion)用户会话。使用Spring Session对反应性Web应用程序的支持时不可用。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("shutdown")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("允许应用以优雅的方式关闭（默认情况下不启用）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("No")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("threaddump")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("执行一个线程dump")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])])])]),t._v(" "),a("p",[t._v("如果使用web应用(Spring MVC, Spring WebFlux, 或者 Jersey)，你还可以使用以下端点：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("ID")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认启用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("heapdump")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回一个GZip压缩的"),a("code",[t._v("hprof")]),t._v("堆dump文件")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("jolokia")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("通过HTTP暴露"),a("code",[t._v("JMX beans")]),t._v("（当Jolokia在类路径上时，WebFlux不可用）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("logfile")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回"),a("code",[t._v("日志文件内容")]),t._v("（如果设置了logging.file或logging.path属性的话），支持使用HTTP "),a("strong",[t._v("Range")]),t._v("头接收日志文件内容的部分信息")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("prometheus")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("以可以被Prometheus服务器抓取的格式显示"),a("code",[t._v("metrics")]),t._v("信息")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Yes")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);