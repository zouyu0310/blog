(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{1176:function(t,s,a){"use strict";a.r(s);var r=a(14),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"rdb-aof混合持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rdb-aof混合持久化"}},[t._v("#")]),t._v(" RDB-AOF混合持久化")]),t._v(" "),s("h3",{attrs:{id:"官网建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官网建议"}},[t._v("#")]),t._v(" 官网建议")]),t._v(" "),s("p",[s("img",{attrs:{src:a(670),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"rdb-vs-aof"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rdb-vs-aof"}},[t._v("#")]),t._v(" RDB VS AOF")]),t._v(" "),s("p",[s("strong",[t._v("问题：")])]),t._v(" "),s("p",[t._v("可否共存？")]),t._v(" "),s("p",[t._v("如果共存听谁的？")]),t._v(" "),s("p",[s("strong",[t._v("Redis配置文档解答：RDB和AOF共存时会优先加载AOF文件")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(671),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("$\\textcolor{red}{数据恢复顺序和加载流程}$")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(672),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"你怎么选-用哪个"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#你怎么选-用哪个"}},[t._v("#")]),t._v(" 你怎么选？用哪个？")]),t._v(" "),s("ul",[s("li",[t._v("RDB持久化方式能够在指定的时间间隔对你的数据进行快照存储。")]),t._v(" "),s("li",[t._v("AOF持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以redis协议追加保存每次写的操作到文件末尾。")])]),t._v(" "),s("h3",{attrs:{id:"同时开启两种持久化方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同时开启两种持久化方式"}},[t._v("#")]),t._v(" 同时开启两种持久化方式")]),t._v(" "),s("ul",[s("li",[t._v("在这种情况下，$\\textcolor{red}{当redis重启的时候会优先载入AOF文件来恢复原始的数据}$，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。")]),t._v(" "),s("li",[t._v("RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。但是作者也不建议只使用AOF方式备份，因为RDB更适合用于备份数据库（AOF在不断的变化不好备份），留着RDB作为一个万一的手段。")])]),t._v(" "),s("h3",{attrs:{id:"推荐方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#推荐方式"}},[t._v("#")]),t._v(" 推荐方式")]),t._v(" "),s("p",[t._v("RDB+AOF混合方式")]),t._v(" "),s("p",[t._v("1开启混合方式设置\n$\\textcolor{red}{设置aof-use-rdb-preamble的值为yes， yes表示开启，设置为no表示禁用}$\n2 RDB+AOF的混合方式---------\x3e结论:RDB镜像做全量持久化，AOF做增量持久化\n先使用RDB进行快照存储，然后使用AOF持久化记录所有的写操作，当重写策略满足或手动触发重写的时候，将最新的数据存储为新的RDB记录。这样的话，重启服务的时候会从RDB和AOF两部分恢复数据，既保证了数据完整性，又提高了恢复数据的性能。简单来说:混合持久化方式产生的文件一部分是RDB格式，一部分是AOF格式。----》AOF包括了RDB头部+AOF混写")]),t._v(" "),s("p",[s("img",{attrs:{src:a(673),alt:""}})])])}),[],!1,null,null,null);s.default=e.exports},670:function(t,s,a){t.exports=a.p+"assets/img/53.2819a34c.jpg"},671:function(t,s,a){t.exports=a.p+"assets/img/54.bd763e87.jpg"},672:function(t,s,a){t.exports=a.p+"assets/img/55.b2757614.jpg"},673:function(t,s,a){t.exports=a.p+"assets/img/56.ffa7914f.jpg"}}]);