(window.webpackJsonp=window.webpackJsonp||[]).push([[500],{1180:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"怎么玩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么玩"}},[t._v("#")]),t._v(" 怎么玩")]),t._v(" "),a("p",[t._v("官网 ：https://redis.io/docs/manual/transactions/")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/1.Redis%E4%BA%8B%E5%8A%A1%E7%94%A8%E6%B3%95%E5%AE%98%E7%BD%91%E4%BB%8B%E7%BB%8D.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/2.Redis%E4%BA%8B%E5%8A%A1%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"case1-正常执行-multi-exec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#case1-正常执行-multi-exec"}},[t._v("#")]),t._v(" case1：正常执行 MULTI EXEC")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/3.Redis%E4%BA%8B%E5%8A%A1%E6%AD%A3%E5%B8%B8%E6%89%A7%E8%A1%8C.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"case2-放弃事务-multi-discard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#case2-放弃事务-multi-discard"}},[t._v("#")]),t._v(" case2：放弃事务 MULTI DISCARD")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/4.Redis%E6%94%BE%E5%BC%83%E4%BA%8B%E5%8A%A1.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"case3-全体连坐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#case3-全体连坐"}},[t._v("#")]),t._v(" case3：全体连坐")]),t._v(" "),a("p",[t._v("官网说明：")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/5.%E5%85%A8%E4%BD%93%E8%BF%9E%E5%9D%90-%E5%86%A4%E5%A4%B4%E5%80%BA%E4%B8%BB.jpg",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"images/6.Redis%E4%BA%8B%E5%8A%A1%E5%85%A8%E4%BD%93%E8%BF%9E%E5%9D%90.jpg",alt:""}})]),t._v(" "),a("p",[t._v("一个语法出错，全体连坐。如果任何一个命令语法有错，Redis会直接返回错误，所有的命令都不会执行")]),t._v(" "),a("h3",{attrs:{id:"case4-冤头债主"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#case4-冤头债主"}},[t._v("#")]),t._v(" case4：冤头债主")]),t._v(" "),a("p",[a("strong",[t._v("官网说明：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"images/7.Redis%E4%BA%8B%E5%8A%A1%E5%86%A4%E5%A4%B4%E5%80%BA%E4%B8%BB.jpg",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("补充：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"images/8.Redis%E4%B8%8D%E6%8F%90%E4%BE%9B%E5%9B%9E%E6%BB%9A%E5%8A%9F%E8%83%BD.jpg",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"images/9.Redis%E5%86%A4%E5%A4%B4%E5%80%BA%E4%B8%BB.jpg",alt:""}})]),t._v(" "),a("p",[t._v("$\\textcolor{red}{注意和传统数据库事务的区别，不一定要么全部成功要么全部失败}$")]),t._v(" "),a("h3",{attrs:{id:"case5-watch监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#case5-watch监控"}},[t._v("#")]),t._v(" case5：watch监控")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("Redis使用Watch来提供乐观锁定，类似于CAS(Check-and-Set)")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("悲观锁：悲观锁(Pessimistic Lock)，顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁")])]),t._v(" "),a("li",[a("p",[t._v("乐观锁：乐观锁(Optimistic Lock)，顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，$\\textcolor{red}{所以不会上锁}$，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据。")]),t._v(" "),a("p",[t._v("$\\textcolor{red}{乐观锁策略：提交版本必须大于记录当前版本才能执行更新}$")])]),t._v(" "),a("li",[a("p",[t._v("CAS")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/10.Redis%E7%9A%84CAS.jpg",alt:""}})])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("watch key [key ...]")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("初始化k1和balance两个key，先监控在开启multi，保证两个key变动在同一个事务内")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/11.Redis-watch.jpg",alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("有加塞篡改：watch命令是一种乐观锁的实现，Redis在修改的时候会检测数据是否被更改，如果被更改了，则执行失败")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/12.watch%E6%97%B6key%E8%A2%AB%E4%BF%AE%E6%94%B9.jpg",alt:""}})]),t._v(" "),a("p",[t._v("图中3和4不管哪个先执行，最终的结果都是整个事务执行失败")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/13.watch%E5%8A%A0%E5%A1%9E%E7%AF%A1%E6%94%B9%E5%AE%98%E6%96%B9%E8%AF%B4%E6%98%8E.jpg",alt:""}})])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("unwatch")])]),t._v(" "),a("p",[a("img",{attrs:{src:"images/14.unwatch.jpg",alt:""}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("小结")])]),t._v(" "),a("p",[t._v("一旦执行了exec之前加的监控锁都会被取消掉")]),t._v(" "),a("p",[t._v("当客户端连接丢失的时候(比如退出链接)，所有东西都会被取消监视")])])]),t._v(" "),a("h3",{attrs:{id:"小总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小总结"}},[t._v("#")]),t._v(" 小总结")]),t._v(" "),a("p",[t._v("$\\textcolor{red}{开启}$：以multi开始一个事务")]),t._v(" "),a("p",[t._v("$\\textcolor{red}{入队}$：将多个命令入队到事务中，接到这些命令并不会立即执行，而是放到等待执行的事务队列里面")]),t._v(" "),a("p",[t._v("$\\textcolor{red}{执行}$：有exec命令触发事务")])])}),[],!1,null,null,null);a.default=r.exports}}]);