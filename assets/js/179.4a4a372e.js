(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{776:function(t,s,a){"use strict";a.r(s);var e=a(14),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"三种特殊数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三种特殊数据类型"}},[t._v("#")]),t._v(" 三种特殊数据类型")]),t._v(" "),s("h3",{attrs:{id:"geo地理位置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#geo地理位置"}},[t._v("#")]),t._v(" GEO地理位置")]),t._v(" "),s("h4",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[t._v("Redis 的 GEO 特性在 Redis 3.2 版本中推出， 这个功能可以将用户给定的地理位置信息储存起来， 并对这些信息进行操作。来实现诸如附近位置、摇一摇这类依赖于地理位置信息的功能。geo的数据类型为 zset。")]),t._v(" "),s("p",[t._v("GEO 的数据结构总共有六个常用命令：geoadd、geopos、geodist、georadius、 georadiusbymember、gethash")]),t._v(" "),s("p",[t._v("官方文档：https://www.redis.net.cn/order/3685.html")]),t._v(" "),s("h4",{attrs:{id:"常用指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用指令"}},[t._v("#")]),t._v(" 常用指令")]),t._v(" "),s("p",[s("strong",[t._v("1、geoadd")])]),t._v(" "),s("p",[t._v("语法：geoadd key longitude latitude member ...")]),t._v(" "),s("p",[t._v("将给定的空间元素(经度、纬度、名字)添加到指定的键里面。\n这些数据会以有序集的形式被储存在键里面，从而使得georadius和georadiusbymember这样的\n命令可以在之后通过位置查询取得这些元素。\ngeoadd命令以标准的x,y格式接受参数，所以用户必须先输入经度，然后再输入纬度。\ngeoadd能够记录的坐标是有限的：非常接近两极的区域无法被索引。\n有效的经度介于-180-180度之间，有效的纬度介于-85.05112878 度至 85.05112878 度之间\n当用户尝试输入一个超出范围的经度或者纬度时,geoadd命令将返回一个错误。")]),t._v(" "),s("p",[t._v("测试：百度搜索经纬度查询，模拟真实数据")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geoadd china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("116.23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("40.22")]),t._v(" 北京\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geoadd china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("121.48")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31.40")]),t._v(" 上海 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("113.88")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22.55")]),t._v(" 深圳 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120.21")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.20")]),t._v(" 杭州\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geoadd china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("106.54")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29.40")]),t._v(" 重庆 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("108.93")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("34.23")]),t._v(" 西安 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("114.02")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.58")]),t._v(" 武汉\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])]),s("p",[s("strong",[t._v("2、geopos")])]),t._v(" "),s("p",[t._v("语法：geopos key member [member...]")]),t._v(" "),s("p",[t._v("从key里返回所有给定位置元素的位置（经度和纬度）")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geopos china:city 北京\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"116.23000055551528931"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"40.2200010338739844"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geopos china:city 上海 重庆\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"121.48000091314315796"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"31.40000025319353938"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"106.54000014066696167"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"29.39999880018641676"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geopos china:city 新疆\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("3、geodist")])]),t._v(" "),s("p",[t._v("语法：geodist key member1 member2 [unit]")]),t._v(" "),s("p",[t._v("返回两个给定位置之间的距离，如果两个位置之间的其中一个不存在，那么命令返回空值")]),t._v(" "),s("p",[t._v("指定单位的参数unit必须是以下单位的其中一个：")]),t._v(" "),s("ul",[s("li",[t._v("m表示单位为米")]),t._v(" "),s("li",[t._v("km表示单位为千米")]),t._v(" "),s("li",[t._v("mi表示单位为英里")]),t._v(" "),s("li",[t._v("ft表示单位为英尺")])]),t._v(" "),s("p",[t._v("如果用户没有显式地指定单位参数，那么geodist默认使用 米 作为单位。")]),t._v(" "),s("p",[t._v("geodist命令在计算距离时会假设地球为完美的球形，在极限情况下，这一假设最大会造成0.5%的误差。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geodist china:city 北京 上海\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1088785.4302"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geodist china:city 北京 上海 km\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1088.7854"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geodist china:city 重庆 北京 km\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1491.6716"')]),t._v("\n")])])]),s("p",[s("strong",[t._v("4、georadius")])]),t._v(" "),s("p",[t._v("语法：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("georadius key longitude latitude radius m"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("km"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ft"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("mi "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withcoord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withdist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withhash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("desc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("以给定的经纬度为中心， 找出某一半径内的元素")]),t._v(" "),s("p",[t._v("重新连接 redis-cli，增加参数 --raw ，可以强制输出中文，不然会乱码")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" georadius china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#乱码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xe9"}},[t._v("\\xe9")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x87"}},[t._v("\\x87")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x8d"}},[t._v("\\x8d")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xe5"}},[t._v("\\xe5")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xba"}},[t._v("\\xba")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x86"}},[t._v("\\x86")]),t._v('"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xe8"}},[t._v("\\xe8")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xa5"}},[t._v("\\xa5")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xbf"}},[t._v("\\xbf")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xe5"}},[t._v("\\xe5")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xae"}},[t._v("\\xae")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x89"}},[t._v("\\x89")]),t._v('"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  redis-cli --raw -p 6379")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 china:city 中寻找坐标 100 30 半径为 1000km 的城市")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" georadius china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km\n重庆\n西安\n\n")])])]),s("p",[t._v("withdist 返回位置名称和中心距离")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" georadius china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km withdist\n重庆\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("635.2850")]),t._v("\n西安\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("963.3171")]),t._v("\n")])])]),s("p",[t._v("withcoord 返回位置名称、经纬度")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" georadius china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km withcoord\n重庆\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("106.54000014066696167")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29.39999880018641676")]),t._v("\n西安\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("108.92999857664108276")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("34.23000121926852302")]),t._v("\n")])])]),s("p",[t._v("withdist withcoord 返回位置名称、距离、经纬度，count 限定寻找个数")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" georadius china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km withcoord withdist count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n重庆\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("635.2850")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("106.54000014066696167")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29.39999880018641676")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" georadius china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km withcoord withdist count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n重庆\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("635.2850")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("106.54000014066696167")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29.39999880018641676")]),t._v("\n西安\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("963.3171")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("108.92999857664108276")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("34.23000121926852302")]),t._v("\n")])])]),s("p",[s("strong",[t._v("5、georadiusbymember")])]),t._v(" "),s("p",[t._v("语法：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("georadiusbymember key member radius m"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("km"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ft"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("mi "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withcoord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withdist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withhash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("desc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("找出位于指定范围内的元素，中心点是由给定的位置元素决定")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" GEORADIUSBYMEMBER china:city 北京 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" km\n北京\n西安\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" GEORADIUSBYMEMBER china:city 上海 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),t._v(" km\n杭州\n上海\n")])])]),s("p",[s("strong",[t._v("6、geohash")])]),t._v(" "),s("p",[t._v("语法：geohash key member [member...]")]),t._v(" "),s("p",[t._v("Redis使用geohash将二维经纬度转换为一维字符串，字符串越长表示位置更精确，两个字符串越相似表示距离越近。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geohash china:city 北京 重庆\nwx4sucu47r0\nwm5z22h53v0\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geohash china:city 北京 上海\nwx4sucu47r0\nwtw6sk5n300\n")])])]),s("p",[s("strong",[t._v("zrem")])]),t._v(" "),s("p",[t._v("GEO没有提供删除成员的命令，但是因为GEO的底层实现是zset，所以可以借用zrem命令实现对地理位置信息的删除。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" geoadd china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("116.23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("40.22")]),t._v(" beijing\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" zrange china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看全部的元素")]),t._v("\n重庆\n西安\n深圳\n武汉\n杭州\n上海\nbeijing\n北京\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" zrem china:city beijing "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 移除元素")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" zrem china:city 北京 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 移除元素")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" zrange china:city "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-1")]),t._v("\n重庆\n西安\n深圳\n武汉\n杭州\n上海\n")])])]),s("h3",{attrs:{id:"hyperloglog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog"}},[t._v("#")]),t._v(" HyperLogLog")]),t._v(" "),s("p",[t._v("Redis 在 2.8.9 版本添加了 HyperLogLog 结构。")]),t._v(" "),s("p",[t._v("Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。")]),t._v(" "),s("p",[t._v("在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。")]),t._v(" "),s("p",[t._v("HyperLogLog则是一种算法，它提供了不精确的去重计数方案。")]),t._v(" "),s("p",[t._v("举个栗子：假如我要统计网页的UV（浏览用户数量，一天内同一个用户多次访问只能算一次），传统的解决方案是使用Set来保存用户id，然后统计Set中的元素数量来获取页面UV。但这种方案只能承载少量用户，一旦用户数量大起来就需要消耗大量的空间来存储用户id。我的目的是统计用户数量而不是保存用户，这简直是个吃力不讨好的方案！而使用Redis的HyperLogLog最多需要12k就可以统计大量的用户数，尽管它大概有0.81%的错误率，但对于统计UV这种不需要很精确的数据是可以忽略不计的。")]),t._v(" "),s("p",[s("strong",[t._v("什么是基数？")])]),t._v(" "),s("p",[t._v("比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素的数量)为5。")]),t._v(" "),s("p",[t._v("基数估计就是在误差可接受的范围内，快速计算基数。")]),t._v(" "),s("p",[s("strong",[t._v("基本命令")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("序号")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("命令及描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("[PFADD key element "),s("a",{attrs:{href:"https://www.runoob.com/redis/hyperloglog-pfadd.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("element ...]"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("添加指定元素到 HyperLogLog 中。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("[PFCOUNT key "),s("a",{attrs:{href:"https://www.runoob.com/redis/hyperloglog-pfcount.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("key ...]"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("返回给定 HyperLogLog 的基数估算值。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("[PFMERGE destkey sourcekey "),s("a",{attrs:{href:"https://www.runoob.com/redis/hyperloglog-pfmerge.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("sourcekey ...]"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("将多个 HyperLogLog 合并为一个 HyperLogLog，并集计算")])])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" PFADD mykey a b c d e f g h i j\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" PFCOUNT mykey\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" PFADD mykey2 i j z x c "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v(" b n m\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" PFMERGE mykey3 mykey mykey2\nOK\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" PFCOUNT mykey3\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("\n")])])]),s("h3",{attrs:{id:"bitmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bitmap"}},[t._v("#")]),t._v(" BitMap")]),t._v(" "),s("h4",{attrs:{id:"简介-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介-2"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[t._v("在开发中，可能会遇到这种情况：需要统计用户的某些信息，如活跃或不活跃，登录或者不登录；又如 需要记录用户一年的打卡情况，打卡了是1， 没有打卡是0，如果使用普通的 key/value存储，则要记录 365条记录，如果用户量很大，需要的空间也会很大，所以 Redis 提供了 Bitmap 位图这中数据结构， Bitmap 就是通过操作二进制位来进行记录，即为 0 和 1；如果要记录 365 天的打卡情况，使用 Bitmap 表示的形式大概如下：0101000111000111...........................，这样有什么好处呢？当然就是节约内存 了，365 天相当于 365 bit，又 1 字节 = 8 bit , 所以相当于使用 46 个字节即可。")]),t._v(" "),s("p",[t._v("BitMap 就是通过一个 bit 位来表示某个元素对应的值或者状态, 其中的 key 就是对应元素本身，实际上底层也是通过对字符串的操作来实现。Redis 从 2.2 版本之后新增了setbit, getbit, bitcount 等几个 bitmap 相关命令。")]),t._v(" "),s("h4",{attrs:{id:"操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#操作"}},[t._v("#")]),t._v(" "),s("strong",[t._v("操作")])]),t._v(" "),s("p",[s("strong",[t._v("1、setbit 设置操作")])]),t._v(" "),s("p",[t._v("SETBIT key offset value : 设置 key 的第 offset 位为value (1或0)")]),t._v(" "),s("p",[t._v("使用 bitmap 来记录上述事例中一周的打卡记录如下所示：")]),t._v(" "),s("p",[t._v("周一：1，周二：0，周三：0，周四：1，周五：1，周六：0，周天：0 （1 为打卡，0 为不打卡）")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" setbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[s("strong",[t._v("2、getbit 获取操作")])]),t._v(" "),s("p",[t._v("GETBIT key offset 获取offset设置的值，未设置过默认返回0")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" getbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看周四是否打卡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" getbit sign "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看周七是否打卡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[s("strong",[t._v("3、bitcount 统计操作")])]),t._v(" "),s("p",[t._v("bitcount key [start, end] 统计 key 上位为1的个数")]),t._v(" "),s("p",[t._v("统计这周打卡的记录，可以看到只有3天是打卡的状态：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" bitcount sign\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);