(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1095:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_57-hystrix之通配服务降级feignfallback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_57-hystrix之通配服务降级feignfallback"}},[t._v("#")]),t._v(" 57_Hystrix之通配服务降级FeignFallback")]),t._v(" "),a("p",[t._v("目前问题2 统一和自定义的分开，代码混乱")]),t._v(" "),a("p",[t._v("服务降级，客户端去调用服务端，碰上服务端宕机或关闭")]),t._v(" "),a("p",[t._v("本次案例服务降级处理是在客户端80实现完成的，与服务端8001没有关系，只需要为Feign客户端定义的接口添加一个服务降级处理的实现类即可实现解耦")]),t._v(" "),a("p",[t._v("未来我们要面对的异常")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("运行\n超时\n宕机\n")])])]),a("p",[t._v("修改cloud-consumer-feign-hystrix-order80 --"),a("strong",[t._v("消费者端")])]),t._v(" "),a("p",[t._v("根据cloud-consumer-feign-hystrix-order80已经有的PaymentHystrixService接口，\n重新新建一个类(AaymentFallbackService)"),a("strong",[t._v("实现")]),t._v(" 该接口，统一为接口里面的方法进行异常处理")]),t._v(" "),a("p",[t._v("PaymentFallbackService类实现PaymentHystrixService接口")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springcloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @ClassName PaymentFallbackService\n * @Description PaymentHystrixService实现类,为了处理服务降级 统一为接口里面的方法进行异常处理\n * @Author zouyu\n * @Date 2021/12/28 23:48\n * @Version 1.0\n **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PaymentFallbackService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PaymentHystrixService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentInfo_OK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-----PaymentFallbackService fall back-paymentInfo_OK! ,o(╥﹏╥)o"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentInfo_TimeOut")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-----PaymentFallbackService fall back-paymentInfo_TimeOut! ,o(╥﹏╥)o"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("YML")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#开启\nfeign:\n  hystrix:\n    enabled: true\n")])])]),a("p",[t._v("PaymentHystrixService接口")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FeignClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CLOUD-PROVIDER-HYSTRIX-PAYMENT"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//激活   找哪个微服务")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PaymentFallbackService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//指定PaymentFallbackService类  所有方法异常处理类")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PaymentHystrixService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/payment/hystrix/ok/{id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentInfo_OK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/payment/hystrix/timeout/{id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentInfo_TimeOut")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("测试")]),t._v(" "),a("p",[t._v("单个eureka先启动7001")]),t._v(" "),a("p",[t._v("PaymentHystrixMain8001启动")]),t._v(" "),a("p",[t._v("正常访问测试 - http://localhost:81/consumer/payment/hystrix/ok/1")]),t._v(" "),a("p",[t._v("故意关闭微服务8001 !!")]),t._v(" "),a("p",[t._v("客户端自己调用提示 - 此时服务端provider已经down了，但是我们做了服务降级处理，让客户端在服务端不可用时也会获得提示信息而不会挂起耗死服务器")]),t._v(" "),a("p",[t._v("8001未关闭")]),t._v(" "),a("p",[a("img",{attrs:{src:s(571),alt:"image-20211228235540245"}})]),t._v(" "),a("p",[t._v("8001已关闭")]),t._v(" "),a("p",[a("img",{attrs:{src:s(572),alt:"image-20211228235641568"}})]),t._v(" "),a("p",[a("img",{attrs:{src:s(573),alt:"image-20211228235713128"}})]),t._v(" "),a("h2",{attrs:{id:"如果方法上没有-或者有-hystrixcommand-注解-访问8001服务的方法都是显示异常实现类中的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果方法上没有-或者有-hystrixcommand-注解-访问8001服务的方法都是显示异常实现类中的方法"}},[t._v("#")]),t._v(" 如果方法上没有/或者有    @HystrixCommand  注解  访问8001服务的方法都是显示异常实现类中的方法")]),t._v(" "),a("p",[a("img",{attrs:{src:s(574),alt:"image-20211229000005731"}})]),t._v(" "),a("h2",{attrs:{id:"但是-如果是80服务自身报错和8001方法无关就会调用80全局异常处理逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#但是-如果是80服务自身报错和8001方法无关就会调用80全局异常处理逻辑"}},[t._v("#")]),t._v(" 但是,如果是80服务自身报错和8001方法无关就会调用80全局异常处理逻辑")]),t._v(" "),a("p",[a("img",{attrs:{src:s(575),alt:"image-20211229000255300"}})]),t._v(" "),a("p",[a("img",{attrs:{src:s(576),alt:"image-20211229000245309"}})])])}),[],!1,null,null,null);a.default=e.exports},571:function(t,a,s){t.exports=s.p+"assets/img/20211228235540.9dc85f8a.png"},572:function(t,a,s){t.exports=s.p+"assets/img/20211228235641.57234a10.png"},573:function(t,a,s){t.exports=s.p+"assets/img/20211228235713.cde8c658.png"},574:function(t,a,s){t.exports=s.p+"assets/img/20211229000005.b3624d58.png"},575:function(t,a,s){t.exports=s.p+"assets/img/20211229000255.219a328e.png"},576:function(t,a,s){t.exports=s.p+"assets/img/20211229000245.cb83762e.png"}}]);