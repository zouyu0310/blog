(window.webpackJsonp=window.webpackJsonp||[]).push([[311],{931:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("ul",[s("li",[s("a",{attrs:{href:"#1-%E5%9F%BA%E4%BA%8Eapt%E6%BA%90%E5%AE%89%E8%A3%85"}},[t._v("1. 基于apt源安装")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#11-%E5%AE%89%E8%A3%85"}},[t._v("1.1 安装")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#12-%E6%B5%8B%E8%AF%95%E5%AE%89%E8%A3%85%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F"}},[t._v("1.2 测试安装是否成功")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#13-%E5%8D%B8%E8%BD%BD"}},[t._v("1.3 卸载")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#1-%E5%81%9C%E6%AD%A2nginx%E6%9C%8D%E5%8A%A1"}},[t._v("1. 停止nginx服务")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#2-%E5%88%A0%E9%99%A4nginx-purge%E5%8C%85%E6%8B%AC%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"}},[t._v("2. 删除nginx，-purge包括配置文件")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#3-%E7%A7%BB%E9%99%A4%E5%85%A8%E9%83%A8%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85"}},[t._v("3. 移除全部不使用的软件包")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#4-%E7%BD%97%E5%88%97%E5%87%BA%E4%B8%8Enginx%E7%9B%B8%E5%85%B3%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%B9%B6%E5%88%A0%E9%99%A4"}},[t._v("4. 罗列出与nginx相关的软件并删除")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#5-%E6%9F%A5%E7%9C%8Bnginx%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%A6%82%E6%9E%9C%E6%9C%89%E5%B0%B1kill%E6%8E%89"}},[t._v("5. 查看nginx正在运行的进程，如果有就kill掉")])])])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#2-%E9%80%9A%E8%BF%87%E6%BA%90%E7%A0%81%E5%8C%85%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"}},[t._v("2. 通过源码包编译安装")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#1-%E5%AE%89%E8%A3%85%E5%90%84%E7%A7%8D%E4%BE%9D%E8%B5%96%E5%BA%93"}},[t._v("1. 安装各种依赖库")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#2-%E5%AE%89%E8%A3%85nginx"}},[t._v("2. 安装Nginx")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#3-%E9%85%8D%E7%BD%AE%E8%BD%AF%E9%93%BE%E6%8E%A5"}},[t._v("3. 配置软链接")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#4-%E9%85%8D%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"}},[t._v("4. 配置开机启动服务")])])])])]),t._v(" "),s("p",[t._v("此安装过程是在ubuntu18下完成的。")]),t._v(" "),s("h1",{attrs:{id:"_1-基于apt源安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-基于apt源安装"}},[t._v("#")]),t._v(" 1. 基于apt源安装")]),t._v(" "),s("h2",{attrs:{id:"_1-1-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装"}},[t._v("#")]),t._v(" 1.1 安装")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("// 更新包\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n// 下载安装nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx\n")])])]),s("p",[t._v("Ubuntu安装之后的文件结构大致为：")]),t._v(" "),s("ul",[s("li",[t._v("所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下")]),t._v(" "),s("li",[t._v("程序文件在/usr/sbin/nginx")]),t._v(" "),s("li",[t._v("日志放在了/var/log/nginx中")]),t._v(" "),s("li",[t._v("并已经在/etc/init.d/下创建了启动脚本nginx")]),t._v(" "),s("li",[t._v("默认的虚拟主机的目录设置在了/var/www/nginx-default (有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置)")])]),t._v(" "),s("p",[t._v("其实从上面的根目录文件夹可以知道，Linux系统的配置文件一般放在/etc，日志一般放在/var/log，运行的程序一般放在/usr/sbin或者/usr/bin。")]),t._v(" "),s("p",[t._v("当然，如果要更清楚Nginx的配置项放在什么地方，可以打开/etc/nginx/nginx.conf")]),t._v(" "),s("p",[t._v("然后通过这种方式安装的，会自动创建服务，会自动在/etc/init.d/nginx新建服务脚本，然后就可以使用一下命令来启动")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("start"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stop"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("reload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("force-reload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("configtest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("rotate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("upgrade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("脚本如下：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### BEGIN INIT INFO")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Provides:\t  nginx")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Required-Start:    $local_fs $remote_fs $network $syslog $named")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Required-Stop:     $local_fs $remote_fs $network $syslog $named")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default-Start:     2 3 4 5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default-Stop:      0 1 6")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Short-Description: starts the nginx web server")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Description:       starts nginx using start-stop-daemon")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### END INIT INFO")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DAEMON")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DESC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Include nginx defaults if available")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" /etc/default/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /etc/default/nginx\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("STOP_SCHEDULE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${STOP_SCHEDULE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":-")]),t._v("QUIT"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("TERM"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("KILL"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("5}")]),t._v('"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-x")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /lib/init/vars.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /lib/lsb/init-functions\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Try to extract nginx pidfile")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Ev")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^\\s*#'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'BEGIN { RS="[;{}]" } { if ($1 == "pid") print $2 }\'')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-z")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/run/nginx.pid\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ULIMIT")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set ulimit if it is set in /etc/default/nginx")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("ulimit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ULIMIT")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("start_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start the daemon/service")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Returns:")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   0 if daemon has been started")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   1 if daemon was already running")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   2 if daemon could not be started")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--start")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--start")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON_OPTS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("test_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Test the nginx configuration")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON_OPTS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("stop_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Stops the daemon/service")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Return")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   0 if daemon has been stopped")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   1 if daemon was already stopped")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   2 if daemon could not be stopped")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   other if a failure occurred")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--retry")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$STOP_SCHEDULE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RETVAL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$RETVAL")]),t._v('"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("reload_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Function that sends a SIGHUP to the daemon/service")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" HUP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("rotate_logs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Rotate log files")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" USR1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("upgrade_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Online upgrade nginx executable")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http://nginx.org/en/docs/control.html")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Return")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   0 if nginx has been successfully upgraded")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   1 if nginx is not running")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   2 if the pid files were not created on time")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   3 if the old master could not be killed")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" start-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" USR2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for both old and new master to write their pid file")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PID}")]),t._v('.oldbin"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PID}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("cnt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("expr")]),t._v(" $cnt + "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cnt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-gt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Everything is ready, gracefully stop the old master")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" start-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" QUIT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PID}")]),t._v('.oldbin"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\tstart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\tstart_nginx\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tstop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Stopping '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\tstop_nginx\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\trestart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Restarting '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Check configuration before stopping nginx")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" test_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configuration error")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n\t\tstop_nginx\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t\tstart_nginx\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Old process is still running")]),t._v("\n\t\t\t\t\t*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Failed to start")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Failed to stop")]),t._v("\n\t\t\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\treload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("force-reload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Reloading '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v(' configuration"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Check configuration before stopping nginx")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is not entirely correct since the on-disk nginx binary")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# may differ from the in-memory one, but that's not common.")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# We prefer to check the configuration and return an error")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to the administrator.")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" test_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configuration error")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n\t\treload_nginx\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tconfigtest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("testconfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Testing '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v(' configuration"')]),t._v("\n\t\ttest_config\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tstatus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tstatus_of_proc "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tupgrade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Upgrading binary"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\tupgrade_nginx\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\trotate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Re-opening '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v(' log files"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\trotate_logs\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Usage: '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v(' {start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&2")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\n")])])]),s("p",[t._v("还有一个好处，创建好的文件由于放在/usr/sbin目录下，所以能直接在终端中使用nginx命令而无需指定路径。")]),t._v(" "),s("h2",{attrs:{id:"_1-2-测试安装是否成功"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-测试安装是否成功"}},[t._v("#")]),t._v(" 1.2 测试安装是否成功")]),t._v(" "),s("p",[t._v("在命令行中输入：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("\n")])])]),s("p",[t._v("窗口显示：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx: the configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/nginx/nginx.conf syntax is ok\nnginx: configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" is successful\n")])])]),s("p",[t._v("在浏览器中输入ip地址：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/krislin_zhao/IMGcloud/raw/master/img/20200519123550.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_1-3-卸载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-卸载"}},[t._v("#")]),t._v(" 1.3 卸载")]),t._v(" "),s("h3",{attrs:{id:"_1-停止nginx服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-停止nginx服务"}},[t._v("#")]),t._v(" 1. 停止nginx服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" nginx stop\n")])])]),s("h3",{attrs:{id:"_2-删除nginx-purge包括配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-删除nginx-purge包括配置文件"}},[t._v("#")]),t._v(" 2. 删除nginx，-purge包括配置文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--purge")]),t._v(" remove nginx\n")])])]),s("h3",{attrs:{id:"_3-移除全部不使用的软件包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-移除全部不使用的软件包"}},[t._v("#")]),t._v(" 3. 移除全部不使用的软件包")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" autoremove\n")])])]),s("h3",{attrs:{id:"_4-罗列出与nginx相关的软件并删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-罗列出与nginx相关的软件并删除"}},[t._v("#")]),t._v(" 4. 罗列出与nginx相关的软件并删除")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("dpkg --get-selections"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--purge")]),t._v(" remove nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--purge")]),t._v(" remove nginx-common\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--purge")]),t._v(" remove nginx-core\n")])])]),s("h3",{attrs:{id:"_5-查看nginx正在运行的进程-如果有就kill掉"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-查看nginx正在运行的进程-如果有就kill掉"}},[t._v("#")]),t._v(" 5. 查看nginx正在运行的进程，如果有就kill掉")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ef")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-9")]),t._v(" XXX\n")])])]),s("h1",{attrs:{id:"_2-通过源码包编译安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-通过源码包编译安装"}},[t._v("#")]),t._v(" 2. 通过源码包编译安装")]),t._v(" "),s("p",[t._v("这种方式可以自定安装指定的模块以及最新的版本。方式更灵活。")]),t._v(" "),s("p",[t._v("官方下载页面：http://nginx.org/en/download.html")]),t._v(" "),s("p",[t._v("configure配置文件详解：http://nginx.org/en/docs/configure.html")]),t._v(" "),s("h2",{attrs:{id:"_1-安装各种依赖库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装各种依赖库"}},[t._v("#")]),t._v(" 1. 安装各种依赖库")]),t._v(" "),s("p",[t._v("安装gcc g++的依赖库")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" build-essential\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" libtool\n")])])]),s("p",[t._v("安装pcre依赖库（http://www.pcre.org/）")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" libpcre3 libpcre3-dev\n")])])]),s("p",[t._v("安装zlib依赖库（"),s("a",{attrs:{href:"http://www.zlib.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.zlib.net"),s("OutboundLink")],1),t._v("）")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" zlib1g-dev\n")])])]),s("p",[t._v("安装SSL依赖库（18.04默认已经安装了）")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" openssl\n")])])]),s("h2",{attrs:{id:"_2-安装nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装nginx"}},[t._v("#")]),t._v(" 2. 安装Nginx")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#下载最新版本：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://nginx.org/download/nginx-1.13.6.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-zxvf")]),t._v(" nginx-1.13.6.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入解压目录：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.13.6\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置：")]),t._v("\n./configure "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" /usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /usr/local/nginx/conf/nginx.conf\n注意：-c 指定配置文件的路径，不加的话，nginx会自动加载默认路径的配置文件，可以通过-h查看帮助命令。\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看进程：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ef")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n")])])]),s("h2",{attrs:{id:"_3-配置软链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置软链接"}},[t._v("#")]),t._v(" 3. 配置软链接")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" /usr/local/nginx/sbin/nginx /usr/bin/nginx\n")])])]),s("p",[t._v("现在就可以不用路径直接输入nginx启动。")]),t._v(" "),s("h2",{attrs:{id:"_4-配置开机启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置开机启动服务"}},[t._v("#")]),t._v(" 4. 配置开机启动服务")]),t._v(" "),s("p",[t._v("在/etc/init.d/下创建nginx文件，sudo vim /etc/init.d/nginx，内容如下：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### BEGIN INIT INFO")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Provides:\t  nginx")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Required-Start:    $local_fs $remote_fs $network $syslog $named")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Required-Stop:     $local_fs $remote_fs $network $syslog $named")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default-Start:     2 3 4 5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default-Stop:      0 1 6")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Short-Description: starts the nginx web server")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Description:       starts nginx using start-stop-daemon")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### END INIT INFO")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DAEMON")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DESC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Include nginx defaults if available")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" /etc/default/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /etc/default/nginx\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("STOP_SCHEDULE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${STOP_SCHEDULE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":-")]),t._v("QUIT"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("TERM"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("KILL"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("5}")]),t._v('"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-x")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /lib/init/vars.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /lib/lsb/init-functions\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Try to extract nginx pidfile")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Ev")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^\\s*#'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'BEGIN { RS="[;{}]" } { if ($1 == "pid") print $2 }\'')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-z")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/run/nginx.pid\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ULIMIT")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set ulimit if it is set in /etc/default/nginx")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("ulimit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ULIMIT")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("start_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start the daemon/service")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Returns:")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   0 if daemon has been started")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   1 if daemon was already running")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   2 if daemon could not be started")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--start")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--start")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON_OPTS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("test_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Test the nginx configuration")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON_OPTS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("stop_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Stops the daemon/service")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Return")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   0 if daemon has been stopped")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   1 if daemon was already stopped")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   2 if daemon could not be stopped")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   other if a failure occurred")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--retry")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$STOP_SCHEDULE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RETVAL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$RETVAL")]),t._v('"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("reload_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Function that sends a SIGHUP to the daemon/service")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" HUP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("rotate_logs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Rotate log files")]),t._v("\n\tstart-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" USR1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("upgrade_nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Online upgrade nginx executable")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http://nginx.org/en/docs/control.html")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Return")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   0 if nginx has been successfully upgraded")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   1 if nginx is not running")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   2 if the pid files were not created on time")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   3 if the old master could not be killed")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" start-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" USR2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for both old and new master to write their pid file")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PID}")]),t._v('.oldbin"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PID}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("cnt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("expr")]),t._v(" $cnt + "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cnt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-gt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Everything is ready, gracefully stop the old master")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" start-stop-daemon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--stop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--signal")]),t._v(" QUIT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--quiet")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pidfile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PID}")]),t._v('.oldbin"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\tstart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\tstart_nginx\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tstop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Stopping '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\tstop_nginx\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\trestart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Restarting '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Check configuration before stopping nginx")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" test_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configuration error")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n\t\tstop_nginx\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t\tstart_nginx\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Old process is still running")]),t._v("\n\t\t\t\t\t*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" log_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Failed to start")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Failed to stop")]),t._v("\n\t\t\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\treload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("force-reload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Reloading '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v(' configuration"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Check configuration before stopping nginx")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is not entirely correct since the on-disk nginx binary")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# may differ from the in-memory one, but that's not common.")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# We prefer to check the configuration and return an error")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to the administrator.")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" test_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configuration error")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n\t\treload_nginx\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tconfigtest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("testconfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Testing '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v(' configuration"')]),t._v("\n\t\ttest_config\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tstatus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tstatus_of_proc "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAEMON")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tupgrade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Upgrading binary"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\tupgrade_nginx\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\trotate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tlog_daemon_msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Re-opening '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DESC")]),t._v(' log files"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v('"')]),t._v("\n\t\trotate_logs\n\t\tlog_end_msg "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Usage: '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NAME")]),t._v(' {start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&2")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("esac")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置服务脚本有执行权限")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /etc/init.d/nginx\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#注册服务cd /etc/init.d/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" update-rc.d nginx defaults\n")])])]),s("p",[t._v("现在基本上就可以开机启动了，常用的命令如下：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("start"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stop"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("reload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("force-reload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("configtest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("rotate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("upgrade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);