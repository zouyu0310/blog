(window.webpackJsonp=window.webpackJsonp||[]).push([[509],{1182:function(a,t,s){"use strict";s.r(t);var e=s(14),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"复制原理和工作流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制原理和工作流程"}},[a._v("#")]),a._v(" 复制原理和工作流程")]),a._v(" "),t("h3",{attrs:{id:"slave启动-同步初请"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#slave启动-同步初请"}},[a._v("#")]),a._v(" slave启动，同步初请")]),a._v(" "),t("ul",[t("li",[a._v("slave启动成功链接到master后会发送一个sync命令")]),a._v(" "),t("li",[a._v("slave首次全新连接master，一次完全同步(全量复制)将被自动执行，slave自身原有数据会被master数据覆盖清除")])]),a._v(" "),t("h3",{attrs:{id:"首次连接-全量复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#首次连接-全量复制"}},[a._v("#")]),a._v(" 首次连接，全量复制")]),a._v(" "),t("ul",[t("li",[a._v("master节点收到sync命令后会开始在后台保存快照(即RDB持久化，主从复制时会触发RDB)，同时收集所有接收到的用于修改数据集的命令并缓存起来，master节点执行RDB持久化完后，master将RDB快照文件和所有缓存的命令发送到所有slave，以完成一次完全同步")]),a._v(" "),t("li",[a._v("而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中，从而完成复制初始化")])]),a._v(" "),t("h3",{attrs:{id:"心跳持续-保持通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#心跳持续-保持通信"}},[a._v("#")]),a._v(" 心跳持续，保持通信")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("repl-ping-replica-period 10")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/25.png",alt:""}})])])]),a._v(" "),t("h3",{attrs:{id:"进入平稳-增量复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进入平稳-增量复制"}},[a._v("#")]),a._v(" 进入平稳，增量复制")]),a._v(" "),t("ul",[t("li",[a._v("master继续将新的所有收集到的修改命令自动依次传送给slave，完成同步")])]),a._v(" "),t("h3",{attrs:{id:"从机下线-重连续传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从机下线-重连续传"}},[a._v("#")]),a._v(" 从机下线，重连续传")]),a._v(" "),t("ul",[t("li",[a._v("master会检查backlog里面的offset，master和slave都会保存一个复制的offset还有一个masterId，offset是保存在backlog中的。$\\textcolor{red}{master只会把已经缓存的offset后面的数据复制给slave，类似断点续传}$")])]),a._v(" "),t("h3",{attrs:{id:"复制的缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制的缺点"}},[a._v("#")]),a._v(" 复制的缺点")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("复制延时，信号衰减")]),a._v(" "),t("p",[a._v("由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/26.png",alt:""}})])]),a._v(" "),t("li",[t("p",[a._v("master挂了怎么办？")]),a._v(" "),t("p",[a._v("默认情况下，不会在slave节点中自动选一个master")]),a._v(" "),t("p",[a._v("那每次都要人工干预？ -> $\\textcolor{red}{无人值守变成刚需}$")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);