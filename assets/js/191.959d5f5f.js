(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{801:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214049.png",alt:"1586333742105"}})]),t._v(" "),a("blockquote",[a("p",[t._v("Author：Eric")]),t._v(" "),a("p",[t._v("Version：9.0.1")])]),t._v(" "),a("p",[t._v("[TOC]")]),t._v(" "),a("h3",{attrs:{id:"一、引言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、引言"}},[t._v("#")]),t._v(" 一、引言")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_1-1-环境不一致"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-环境不一致"}},[t._v("#")]),t._v(" 1.1 环境不一致")]),t._v(" "),a("blockquote",[a("p",[t._v("我本地运行没问题啊：由于环境不一致，导致相同的程序，运行结果却不一致。")])]),t._v(" "),a("h4",{attrs:{id:"_1-2-隔离性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-隔离性"}},[t._v("#")]),t._v(" 1.2 隔离性")]),t._v(" "),a("blockquote",[a("p",[t._v("哪个哥们又写死循环了，怎么这么卡：在多用户的操作系统下，会因为其他用户的操作失误影响到你自己编些的程序。")])]),t._v(" "),a("h4",{attrs:{id:"_1-3-弹性伸缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-弹性伸缩"}},[t._v("#")]),t._v(" 1.3 弹性伸缩")]),t._v(" "),a("blockquote",[a("p",[t._v("淘宝在双11的时候，用户量暴增：需要很多很多的运维人员去增加部署的服务器，运维成本过高的问题。")])]),t._v(" "),a("h4",{attrs:{id:"_1-4-学习成本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-学习成本"}},[t._v("#")]),t._v(" 1.4 学习成本")]),t._v(" "),a("blockquote",[a("p",[t._v("学习一门技术，得先安装啊：学习每一门技术都要先安装响应的软件，但是还有他所依赖的各种环境，安装软件成本快高过学习成本啦。")])]),t._v(" "),a("h3",{attrs:{id:"二、docker介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、docker介绍"}},[t._v("#")]),t._v(" 二、Docker介绍")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_2-1-docker的由来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-docker的由来"}},[t._v("#")]),t._v(" 2.1 Docker的由来")]),t._v(" "),a("blockquote",[a("p",[t._v("一帮年轻人创业，创办了一家公司，2010年的专门做PAAS平台。但是到了2013年的时候，像亚马逊，微软，Google都开始做PAAS平台。到了2013年，公司资金链断裂，不得不倒闭，于是将公司内的核心技术对外开源，核心技术就是Docker。由于开源了Docker，到了2014年的时候，得到了C轮的融资 $4000W，2015年的时候，得到了D轮的融资.$9500W。于是公司开始全神贯注的维护Docker。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Docker主要作者-所罗门")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214113.png",alt:"1586340594252"}})])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Docker的作者已经离开了维护Docker的团队")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214109.png",alt:"1586340639934"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_2-2-docker的思想"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-docker的思想"}},[t._v("#")]),t._v(" 2.2 Docker的思想")]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("集装箱：会将所有需要的内容放到不同的集装箱中，谁需要这些环境就直接拿到这个集装箱就可以了。")])]),t._v(" "),a("li",[a("p",[t._v("标准化：")]),t._v(" "),a("ul",[a("li",[t._v("运输的标准化：Docker有一个码头，所有上传的集装箱都放在了这个码头上，当谁需要某一个环境，就直接指派大海疼去搬运这个集装箱就可以了。")]),t._v(" "),a("li",[t._v("命令的标准化：Docker提供了一些列的命令，帮助我们去获取集装箱等等操作。")]),t._v(" "),a("li",[t._v("提供了REST的API：衍生出了很多的图形化界面，Rancher。")])])]),t._v(" "),a("li",[a("p",[t._v("隔离性：Docker在运行集装箱内的内容时，会在Linux的内核中，单独的开辟一片空间，这片空间不会影响到其他程序。")])]),t._v(" "),a("li",[a("p",[t._v("中央仓库|注册中心：超级码头，上面放的就是集装箱")])]),t._v(" "),a("li",[a("p",[t._v("镜像：就是集装箱")])]),t._v(" "),a("li",[a("p",[t._v("容器：运行起来的镜像")])])])]),t._v(" "),a("p",[t._v("仓库：是存放镜像的场所，dockerhub是最大的开源仓库，可以通过docker  search   查找所需镜像并通过docker  pull拉取")]),t._v(" "),a("p",[t._v("镜像：docker 真正的操作对象")]),t._v(" "),a("p",[t._v("容器：docker run 启动镜像会变成容器，容器顶层为一个可操作层，修改不会影响镜像。每个镜像可以启动生成多个容器。\n具体操作以及关系如下：")]),t._v(" "),a("img",{staticStyle:{zoom:"150%"},attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214117.png",alt:"img"}}),t._v(" "),a("h3",{attrs:{id:"三、docker的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、docker的安装"}},[t._v("#")]),t._v(" 三、Docker的安装")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_3-1-下载docker依赖的环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-下载docker依赖的环境"}},[t._v("#")]),t._v(" 3.1 下载Docker依赖的环境")]),t._v(" "),a("blockquote",[a("p",[t._v("想安装Docker，需要先将依赖的环境全部下载，就像Maven依赖JDK一样")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" yum-utils device-mapper-persistent-data lvm2\n")])])]),a("h4",{attrs:{id:"_3-2-指定docker镜像源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-指定docker镜像源"}},[t._v("#")]),t._v(" 3.2 指定Docker镜像源")]),t._v(" "),a("blockquote",[a("p",[t._v("默认下载Docker回去国外服务器下载，速度较慢，我们可以设置为阿里云镜像源，速度更快")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n")])])]),a("h4",{attrs:{id:"_3-3-安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-安装docker"}},[t._v("#")]),t._v(" 3.3 安装Docker")]),t._v(" "),a("blockquote",[a("p",[t._v("依然采用yum的方式安装")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yum makecache fast\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-ce\n")])])]),a("h4",{attrs:{id:"_3-4-启动docker并测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-启动docker并测试"}},[t._v("#")]),t._v(" 3.4 启动Docker并测试")]),t._v(" "),a("blockquote",[a("p",[t._v("安装成功后，需要手动启动，设置为开机自启，并测试一下Docker")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动Docker服务")]),t._v("\nsystemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置开机自动启动")]),t._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 测试")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run hello-world\n")])])]),a("h3",{attrs:{id:"四、docker的中央仓库【重点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、docker的中央仓库【重点】"}},[t._v("#")]),t._v(" 四、Docker的中央仓库【"),a("code",[t._v("重点")]),t._v("】")]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("Docker官方的中央仓库：这个仓库是镜像最全的，但是下载速度较慢。")]),t._v(" "),a("p",[t._v("https://hub.docker.com/")])]),t._v(" "),a("li",[a("p",[t._v("国内的镜像网站：网易蜂巢，daoCloud等，下载速度快，但是镜像相对不全。")]),t._v(" "),a("p",[t._v("https://c.163yun.com/hub#/home")]),t._v(" "),a("p",[t._v("http://hub.daocloud.io/     （推荐使用）")])]),t._v(" "),a("li",[a("p",[t._v("在公司内部会采用私服的方式拉取镜像，需要添加配置，如下……")])])])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("公司私服配置阿里云镜像仓库\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cr.console.aliyun.com/cn-hangzhou/instances/mirrors")]),t._v("\n\n# 需要创建/etc/docker/daemon.json，并添加如下内容\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://registry.docker-cn.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ip:port"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n# 重启两个服务\nsystemctl daemon-reload\nsystemctl restart docker\n\n#注：上面配置中ip和port需要自己公司的ip和端口\n")])])]),a("h3",{attrs:{id:"五、镜像的操作【重点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、镜像的操作【重点】"}},[t._v("#")]),t._v(" 五、镜像的操作【"),a("code",[t._v("重点")]),t._v("】")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_5-1-拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-拉取镜像"}},[t._v("#")]),t._v(" 5.1 拉取镜像")]),t._v(" "),a("blockquote",[a("p",[t._v("从中央仓库拉取镜像到本地")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull 镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 举个栗子：docker pull daocloud.io/library/tomcat:8.5.15-jre8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#注：上述中括号可写可不写,如果不写就把默认版本拉取下来。镜像名称可以直接从daocloud拉取，如果不写就默认从中央仓库，速度太慢。")]),t._v("\n")])])]),a("h4",{attrs:{id:"_5-2-查看本地全部镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-查看本地全部镜像"}},[t._v("#")]),t._v(" 5.2 查看本地全部镜像")]),t._v(" "),a("blockquote",[a("p",[t._v("查看本地已经安装过的镜像信息，包含标识，名称，版本，更新时间，大小")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527125443.png",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[t._v("TAG：版本\nIMAGE ID：唯一表示id\nCREATED：在中央仓库的创建时间")]),t._v(" "),a("h4",{attrs:{id:"_5-3-删除本地镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-删除本地镜像"}},[t._v("#")]),t._v(" 5.3 删除本地镜像")]),t._v(" "),a("blockquote",[a("p",[t._v("镜像会占用磁盘空间，可以直接手动删除，表示通过查看获取")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi 镜像的标识 --"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("（IMAGE ID镜像标识或者CONTAINER ID镜像名称）\n")])])]),a("p",[t._v("注：镜像标识只需要分辨出来就行，不用写的特别全。\n出现")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(">Error response from daemon: conflict: unable to delete d1165f221234 (must be forced) - image is being used by stopped container a223324f36fe\n")])])]),a("p",[t._v("说明正在运行不能删除，需要停止。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527125606.png",alt:"在这里插入图片描述"}})]),t._v(" "),a("h4",{attrs:{id:"_5-4-镜像的导入导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-镜像的导入导出"}},[t._v("#")]),t._v(" 5.4 镜像的导入导出")]),t._v(" "),a("blockquote",[a("p",[t._v("如果因为网络原因可以通过硬盘的方式传输镜像，虽然不规范，但是有效，但是这种方式导出的镜像名称和版本都是null，需要手动修改，方便后面操作")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将本地的镜像导出")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" save "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" 导出的路径 镜像id\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载本地的镜像文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" load "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" 镜像文件\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改镜像名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag 镜像id 新镜像名称:版本\n")])])]),a("p",[t._v("例子：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把tomcat镜像导出到当前文件夹下名字为tomcat_image")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" save "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" ./tomcat_image b8\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" load "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" tomcat_image\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改镜像名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag b8 tomcat:8.5\n")])])]),a("p",[t._v("发现repository名为null，可以进行修改")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527131349.png",alt:"image-20210527131332148"}})]),t._v(" "),a("p",[t._v("修改后：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527131915.png",alt:"image-20210527131913914"}})]),t._v(" "),a("h3",{attrs:{id:"六、容器操作【重点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、容器操作【重点】"}},[t._v("#")]),t._v(" 六、容器操作【"),a("code",[t._v("重点")]),t._v("】")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_6-1-运行容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-运行容器"}},[t._v("#")]),t._v(" 6.1 运行容器")]),t._v(" "),a("p",[t._v("容器就是运行起来的镜像。")]),t._v(" "),a("blockquote",[a("p",[t._v("运行容器需要制定具体镜像，如果镜像不存在，会直接下载")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 简单操作")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run 镜像的标识"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n（如果本地有 就写表示  如果本地没有就通过镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("在仓库里拉取）\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 常用的参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" 宿主机端口:容器端口 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" 容器名称 镜像的标识"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -d：代表在后台运行容器（如果不需要查看日志 可以-d）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -p 宿主机端口:容器端口---\x3e为了映射当前Linux的端口和容器的端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --name 容器（容器跑在虚拟机的docker引擎上）名称：指定容器的名称")]),t._v("\n")])])]),a("p",[t._v("举例：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527133855.png",alt:"image-20210527133853829"}})]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 运行tomcat镜像,虚拟机端口8081,容器端口8080，名字标识是tomcat1\ndocker run -d -p 8081:8080 --name tomcat1 b8\n")])])]),a("p",[t._v("访问虚拟机的8081端口，是可以被访问到的")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527134104.png",alt:"image-20210527134055682"}})]),t._v(" "),a("h4",{attrs:{id:"_6-2-查看正在运行的容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-查看正在运行的容器"}},[t._v("#")]),t._v(" 6.2 查看正在运行的容器")]),t._v(" "),a("blockquote",[a("p",[t._v("查看全部正在运行的容器信息")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-qa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -a：查看全部的容器，包括没有运行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -q：只查看容器的标识")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527134904.png",alt:"image-20210527134904470"}})]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("CONTAINER ID: 容器 ID。\n\nIMAGE: 使用的镜像。\n\nCOMMAND: 启动容器时运行的命令。\n\nCREATED: 容器的创建时间。\n\nSTATUS: 容器状态。\n\nPORTS: 容器的端口信息和使用的连接类型（tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("udp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",映射状态\n\nNAMES: 自动分配的容器名称。\n")])])]),a("p",[t._v("小结：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看正在运行的容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看全部容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看正在运行容器的标识")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-q")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看容器标识")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qa")]),t._v("\n")])])]),a("h4",{attrs:{id:"_6-3-查看容器日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-查看容器日志"}},[t._v("#")]),t._v(" 6.3 查看容器日志")]),t._v(" "),a("blockquote",[a("p",[t._v("查看容器日志，以查看容器运行的信息")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" 容器id\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -f：可以滚动查看日志的最后几行")]),t._v("\n如查看tomcat容器运行log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" fd\n")])])]),a("h4",{attrs:{id:"_6-4-进入容器内容部"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-进入容器内容部"}},[t._v("#")]),t._v(" 6.4 进入容器内容部")]),t._v(" "),a("p",[t._v("容器就是docker在linux内核中创建了一部分空间运行服务，也可以进入操作，但是一般不进入操作，一般用于查看容器中文件的存放路径，可使用ls -l查看文件")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" 容器id "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527140238.png",alt:"image-20210527140238276"}})]),t._v(" "),a("p",[t._v("使用exit指令退出容器，回到宿主机。")]),t._v(" "),a("h4",{attrs:{id:"_6-5-复制内容到容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-复制内容到容器"}},[t._v("#")]),t._v(" 6.5 复制内容到容器")]),t._v(" "),a("blockquote",[a("p",[t._v("将宿主机的文件复制到容器内部的指定目录")]),t._v(" "),a("p",[t._v("（可以把容器与宿主机看成两台不同的小电脑 实际容器是在宿主机内又运行起来的一个独立的 Linux）")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" 文件名称 容器id:容器内部路径\n")])])]),a("h4",{attrs:{id:"_6-6-重启-启动-停止-删除容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-重启-启动-停止-删除容器"}},[t._v("#")]),t._v(" 6.6 重启&启动&停止&删除容器")]),t._v(" "),a("blockquote",[a("p",[t._v("容器的启动，停止，删除等操作，后续经常会使用到")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新启动容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" restart 容器id\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动停止运行的容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" start 容器id\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止指定的容器（删除容器前，需要先停止容器）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop 容器id\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止全部容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qa")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除指定容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 容器id\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除全部容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qa")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527144254.png",alt:"image-20210527144254011"}})]),t._v(" "),a("h3",{attrs:{id:"七、docker应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、docker应用"}},[t._v("#")]),t._v(" 七、Docker应用")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_7-1-docker安装tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-docker安装tomcat"}},[t._v("#")]),t._v(" 7.1 Docker安装Tomcat")]),t._v(" "),a("blockquote",[a("p",[t._v("运行Tomcat容器，为部署SSM工程做准备")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" tomcat daocloud.io/library/tomcat:8.5.15-jre8\n")])])]),a("h4",{attrs:{id:"_7-2-docker安装mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-docker安装mysql"}},[t._v("#")]),t._v(" 7.2 Docker安装MySQL")]),t._v(" "),a("blockquote",[a("p",[t._v("运行MySQL容器，为部署SSM工程做准备，此时docker中并没有mysql，它会自动去下载！")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root daocloud.io/library/mysql:5.7.4\n")])])]),a("p",[t._v("此时用Navicat可以进行连接测试")]),t._v(" "),a("p",[t._v("参考:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://www.cnblogs.com/ybyn/p/13698058.html\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run --restart=unless-stopped -d --name mysql -v /etc/my.cnf:/etc/my.cnf -v /data/mysql:/data/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Qianyan89892528 mysql\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/image1/raw/master/img/20210527221720.png",alt:"image-20210527221712451"}})]),t._v(" "),a("h4",{attrs:{id:"_7-3-部署ssm工程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-部署ssm工程"}},[t._v("#")]),t._v(" 7.3 部署SSM工程")]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("修改SSM工程环境，设置为Linux中Docker容器的信息")]),t._v(" "),a("li",[t._v("通过Maven的package重新打成war包")]),t._v(" "),a("li",[t._v("讲Windows下的war包复制到Linux中")]),t._v(" "),a("li",[t._v("通过docker命令将宿主机的war包复制到容器内部")]),t._v(" "),a("li",[t._v("测试访问SSM工程")])])]),t._v(" "),a("p",[t._v("环境准备好之后把war包复制到容器的tomcat中")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" 文件名称 容器id:容器内部路径\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例子")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" ssm.war b00:/usr/local/tomcat/webapps/\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/image1/raw/master/img/20210527230334.png",alt:"image-20210527230332962"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/image1/raw/master/img/20210527230439.png",alt:"image-20210527230438750"}})]),t._v(" "),a("h3",{attrs:{id:"八、数据卷【重点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、数据卷【重点】"}},[t._v("#")]),t._v(" 八、数据卷【"),a("code",[t._v("重点")]),t._v("】")]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("为了部署SSM的工程，需要使用到cp的命令将宿主机内的ssm.war文件复制到容器内部。")]),t._v(" "),a("p",[t._v("数据卷：将宿主机的一个目录映射到容器的一个目录中。")]),t._v(" "),a("p",[t._v("可以在宿主机中操作目录中的内容，那么容器内部映射的文件，也会跟着一起改变。")])]),t._v(" "),a("p",[t._v("也就是说不建议在docker容器中修改任何信息，此时可以使用数据卷把宿主机目录内容映射到容器中。实现一起改变。")]),t._v(" "),a("h4",{attrs:{id:"_8-1-创建数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-创建数据卷"}},[t._v("#")]),t._v(" 8.1 创建数据卷")]),t._v(" "),a("blockquote",[a("p",[t._v("创建数据卷之后，默认会存放在一个目录下 /var/lib/docker/volumes/数据卷名称/_data")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create 数据卷名称\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例子：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume create tomcat\n")])])]),a("p",[t._v("注意：是在宿主机下创建数据卷。")]),t._v(" "),a("h4",{attrs:{id:"_8-2-查看数据卷详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-查看数据卷详情"}},[t._v("#")]),t._v(" 8.2 查看数据卷详情")]),t._v(" "),a("blockquote",[a("p",[t._v("查看数据卷的详细信息，可以查询到存放路径，创建时间等等")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume inspect 数据卷名称\n")])])]),a("h4",{attrs:{id:"_8-3-查看全部数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-查看全部数据卷"}},[t._v("#")]),t._v(" 8.3 查看全部数据卷")]),t._v(" "),a("blockquote",[a("p",[t._v("查看全部数据卷信息")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n")])])]),a("h4",{attrs:{id:"_8-4-删除数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-删除数据卷"}},[t._v("#")]),t._v(" 8.4 删除数据卷")]),t._v(" "),a("blockquote",[a("p",[t._v("删除指定数据卷")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 数据卷名称\n")])])]),a("h4",{attrs:{id:"_8-5-容器映射数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-容器映射数据卷"}},[t._v("#")]),t._v(" 8.5 容器映射数据卷")]),t._v(" "),a("blockquote",[a("p",[t._v("映射有两种方式：")]),t._v(" "),a("ul",[a("li",[t._v("通过数据卷名称映射，如果数据卷不存在。Docker会帮你自动创建，会将容器内部自带的文件，存储在默认的存放路径中。")]),t._v(" "),a("li",[t._v("通过路径映射数据卷，直接指定一个路径作为数据卷的存放位置。但是这个路径下是空的。")])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通过数据卷名称映射")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 数据卷名称:容器内部的路径 镜像id\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通过路径映射数据卷（推荐使用）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 路径:容器内部的路径 镜像id\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("宿主机的一个端口只能映射到容器内部的某一个端口上，比如：8080->80之后，就不能8080->81\n容器内部的某个端口可以被宿主机的多个端口映射,比如：8080->80，8090->80,8099->80\n")])])]),a("h3",{attrs:{id:"九、dockerfile自定义镜像【重点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、dockerfile自定义镜像【重点】"}},[t._v("#")]),t._v(" 九、Dockerfile自定义镜像【"),a("code",[t._v("重点")]),t._v("】")]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("我们可以从中央仓库下载一个镜像，也可以自己手动去制作一个镜像，需要通过Dockerfile去指定自定义镜像的信息")])]),t._v(" "),a("h4",{attrs:{id:"_9-1-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-dockerfile"}},[t._v("#")]),t._v(" 9.1 Dockerfile")]),t._v(" "),a("blockquote",[a("p",[t._v("创建自定义镜像就需要创建一个Dockerfile，如下为Dockerfile的语言")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("from: 指定当前自定义镜像依赖的环境 指定基础镜像 一切从这里开始 \ncopy: 将相对路径下的内容复制到自定义镜像中\nworkdir: 声明镜像的默认工作目录\nrun: 执行的命令，可以编写多个\ncmd: 需要执行的命令（在workdir下执行的，cmd可以写多个，只以最后一个为准）\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 举个例子，制作SSM容器镜像，而且ssm.war要放在Dockerfile的同级目录下（自定义tomcat）")]),t._v("\nfrom daocloud.io/library/tomcat:8.5.15-jre8\ncopy ssm.war /usr/local/tomcat/webapps"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#(写在Dockerfile里)")]),t._v("\n")])])]),a("h4",{attrs:{id:"_9-2-通过dockerfile制作镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-通过dockerfile制作镜像"}},[t._v("#")]),t._v(" 9.2 通过Dockerfile制作镜像")]),t._v(" "),a("blockquote",[a("p",[t._v("编写完Dockerfile后需要通过命令将其制作为镜像，并且要在Dockerfile的当前目录下，之后即可在镜像中查看到指定的镜像信息，注意最后的 "),a("a",{attrs:{href:""}},[t._v(".")])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" 镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 该命令要和Dockerfile文件在同一个目录下执行")]),t._v("\n")])])]),a("h3",{attrs:{id:"十-docker-compose【重点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十-docker-compose【重点】"}},[t._v("#")]),t._v(" 十. Docker-Compose【"),a("code",[t._v("重点")]),t._v("】")]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("之前运行一个镜像，需要添加大量的参数,可以通过Docker-Compose编写这些参数。而且Docker-Compose可以帮助我们批量的管理容器。这些信息只需要通过一个docker-compose.yml文件去维护即可。")])]),t._v(" "),a("h4",{attrs:{id:"_10-1-下载并安装docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-下载并安装docker-compose"}},[t._v("#")]),t._v(" 10.1 下载并安装Docker-Compose")]),t._v(" "),a("h5",{attrs:{id:"_10-1-1-下载docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-1-下载docker-compose"}},[t._v("#")]),t._v(" 10.1.1 下载Docker-Compose")]),t._v(" "),a("blockquote",[a("p",[t._v("去github官网搜索docker-compose，下载1.24.1版本的Docker-Compose")]),t._v(" "),a("p",[t._v("下载路径："),a("a",{attrs:{href:""}},[t._v("https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64")])])]),t._v(" "),a("h5",{attrs:{id:"_10-1-2-设置权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-2-设置权限"}},[t._v("#")]),t._v(" 10.1.2 设置权限")]),t._v(" "),a("blockquote",[a("p",[t._v("需要将DockerCompose文件的名称修改一下，给予DockerCompose文件一个可执行的权限")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" docker-compose-Linux-x86_64 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v("\n")])])]),a("h5",{attrs:{id:"_10-1-3-配置环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-3-配置环境变量"}},[t._v("#")]),t._v(" 10.1.3 配置环境变量")]),t._v(" "),a("blockquote",[a("p",[t._v("方便后期操作，配置一个环境变量")]),t._v(" "),a("p",[t._v("将docker-compose文件移动到了/usr/local/bin , 修改了/etc/profile文件，给/usr/local/bin配置到了PATH中")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" /usr/local/bin\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/profile\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加内容： export PATH=$JAVA_HOME:/usr/local/bin:$PATH")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /etc/profile\n")])])]),a("h5",{attrs:{id:"_10-1-4-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-4-测试"}},[t._v("#")]),t._v(" 10.1.4 测试")]),t._v(" "),a("blockquote",[a("p",[t._v("在任意目录下输入docker-composedocker-compose")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("测试效果")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214146.png",alt:"1586420176720"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_10-2-docker-compose管理mysql和tomcat容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-docker-compose管理mysql和tomcat容器"}},[t._v("#")]),t._v(" 10.2 Docker-Compose管理MySQL和Tomcat容器")]),t._v(" "),a("blockquote",[a("p",[t._v("yml文件以key: value方式来指定配置信息")]),t._v(" "),a("p",[t._v("多个配置信息以换行+缩进的方式来区分")]),t._v(" "),a("p",[t._v("在docker-compose.yml文件中，不要使用制表符")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代表只要docker启动，那么这个容器就跟着一起启动")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.7.4  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定镜像路径")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3306"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  指定端口号的映射")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定MySQL的ROOT用户登录密码")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定时区")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/docker_mysql_tomcat/mysql_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 映射数据卷")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tomcat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8.5.15"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("jre8\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tomcat\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/docker_mysql_tomcat/tomcat_webapps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/tomcat/webapps\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/docker_mysql_tomcat/tomcat_logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/tomcat/logs\n")])])]),a("h4",{attrs:{id:"_10-3-使用docker-compose命令管理容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-使用docker-compose命令管理容器"}},[t._v("#")]),t._v(" 10.3 使用docker-compose命令管理容器")]),t._v(" "),a("blockquote",[a("p",[t._v("在使用docker-compose的命令时 ，默认会在当前目录下找docker-compose.yml文件")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 基于docker-compose.yml启动管理的容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 关闭并删除容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" down\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3. 开启|关闭|重启已经存在的由docker-compose维护的容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" start"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("restart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4. 查看由docker-compose管理的容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5. 查看日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v("\n")])])]),a("h4",{attrs:{id:"_10-4-docker-compose配合dockerfile使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-docker-compose配合dockerfile使用"}},[t._v("#")]),t._v(" 10.4 docker-compose配合Dockerfile使用")]),t._v(" "),a("blockquote",[a("p",[t._v("使用docker-compose.yml文件以及Dockerfile文件在生成自定义镜像的同时启动当前镜像，并且由docker-compose去管理容器")])]),t._v(" "),a("h5",{attrs:{id:"_10-4-1-docker-compose文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-1-docker-compose文件"}},[t._v("#")]),t._v(" 10.4.1 docker-compose文件")]),t._v(" "),a("blockquote",[a("p",[t._v("编写docker-compose.yml文件")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yml文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ssm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建自定义镜像")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ../      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定dockerfile文件的所在路径")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dockerfile   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定Dockerfile文件名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ssm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ssm\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8081"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n")])])]),a("h5",{attrs:{id:"_10-4-2-dockerfile文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-2-dockerfile文件"}},[t._v("#")]),t._v(" 10.4.2 Dockerfile文件")]),t._v(" "),a("blockquote",[a("p",[t._v("编写Dockerfile文件")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("from daocloud.io/library/tomcat:8.5.15-jre8\ncopy ssm.war /usr/local/tomcat/webapps\n")])])]),a("h5",{attrs:{id:"_10-4-3-运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-3-运行"}},[t._v("#")]),t._v(" 10.4.3 运行")]),t._v(" "),a("blockquote",[a("p",[t._v("测试效果")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以直接启动基于docker-compose.yml以及Dockerfile文件构建的自定义镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果自定义镜像不存在，会帮助我们构建出自定义镜像，如果自定义镜像已经存在，会直接运行这个自定义镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新构建的话。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新构建自定义镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" build\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行当前内容，并重新构建")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--build")]),t._v("\n")])])]),a("h3",{attrs:{id:"十一-docker-ci、cd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十一-docker-ci、cd"}},[t._v("#")]),t._v(" 十一. Docker CI、CD")]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"_11-1-ci、cd引言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-ci、cd引言"}},[t._v("#")]),t._v(" 11.1 CI、CD引言")]),t._v(" "),a("blockquote",[a("p",[t._v("项目部署")]),t._v(" "),a("ul",[a("li",[t._v("将项目通过maven进行编译打包")]),t._v(" "),a("li",[t._v("将文件上传到指定的服务器中")]),t._v(" "),a("li",[t._v("将war包放到tomcat的目录中")]),t._v(" "),a("li",[t._v("通过Dockerfile将Tomcat和war包转成一个镜像，由DockerCompose去运行容器")])]),t._v(" "),a("p",[t._v("项目更新后，需要将上述流程再次的从头到尾的执行一次，如果每次更新一次都执行一次上述操作，很费时，费力。我们就可以通过CI、CD帮助我们实现持续集成，持续交付和部署。")])]),t._v(" "),a("h4",{attrs:{id:"_11-2-ci介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-ci介绍"}},[t._v("#")]),t._v(" 11.2 CI介绍")]),t._v(" "),a("blockquote",[a("p",[t._v("CI（continuous intergration）持续集成")]),t._v(" "),a("p",[t._v("持续集成：编写代码时，完成了一个功能后，立即提交代码到Git仓库中，将项目重新的构建并且测试。")]),t._v(" "),a("ul",[a("li",[t._v("快速发现错误。")]),t._v(" "),a("li",[t._v("防止代码偏离主分支。")])])]),t._v(" "),a("h4",{attrs:{id:"_11-3-搭建gitlab服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-搭建gitlab服务器"}},[t._v("#")]),t._v(" 11.3 搭建Gitlab服务器")]),t._v(" "),a("blockquote",[a("p",[t._v("实现CI，需要使用到Gitlab远程仓库，先通过Docker搭建Gitlab")])]),t._v(" "),a("h5",{attrs:{id:"_11-3-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-1-准备工作"}},[t._v("#")]),t._v(" 11.3.1 准备工作")]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("创建一个全新的虚拟机，并且至少指定4G的运行内存，4G运行内存是Gitlab推荐的内存大小。")]),t._v(" "),a("li",[t._v("并且安装Docker以及Docker-Compose")])])]),t._v(" "),a("h5",{attrs:{id:"_11-3-2-修改ssh的22端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-2-修改ssh的22端口"}},[t._v("#")]),t._v(" 11.3.2 修改ssh的22端口")]),t._v(" "),a("blockquote",[a("p",[t._v("将ssh的默认22端口，修改为60022端口，因为Gitlab需要占用22端口")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /etc/ssh/sshd_config\n  PORT 22 -> 60022\nsystemctl restart sshd\n")])])]),a("h5",{attrs:{id:"_11-3-3-编写docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-3-编写docker-compose-yml"}},[t._v("#")]),t._v(" 11.3.3 编写docker-compose.yml")]),t._v(" "),a("blockquote",[a("p",[t._v("docker-compose.yml文件去安装gitlab（下载和运行的时间比较长的）")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'twang2218/gitlab-ce-zh:11.1.4'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gitlab"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITLAB_OMNIBUS_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    external_url 'http://192.168.199.110'\n    gitlab_rails['time_zone'] = 'Asia/Shanghai'\n    gitlab_rails['smtp_enable'] = true\n    gitlab_rails['gitlab_shell_ssh_port'] = 22")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'80:80'")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'443:443'")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'22:22'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/docker_gitlab/config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/docker_gitlab/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/opt/gitlab\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/docker_gitlab/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/gitlab\n")])])]),a("h4",{attrs:{id:"_11-4-搭建gitlabrunner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-4-搭建gitlabrunner"}},[t._v("#")]),t._v(" 11.4 搭建GitlabRunner")]),t._v(" "),a("blockquote",[a("p",[t._v("查看资料中的gitlab-runner文件即可安装")])]),t._v(" "),a("h4",{attrs:{id:"_11-5-整合项目入门测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-整合项目入门测试"}},[t._v("#")]),t._v(" 11.5 整合项目入门测试")]),t._v(" "),a("h5",{attrs:{id:"_11-5-1-创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-1-创建项目"}},[t._v("#")]),t._v(" 11.5.1 创建项目")]),t._v(" "),a("blockquote",[a("p",[t._v("创建maven工程，添加web.xml文件，编写html页面")])]),t._v(" "),a("h5",{attrs:{id:"_11-5-2-编写-gitlab-ci-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-2-编写-gitlab-ci-yml"}},[t._v("#")]),t._v(" 11.5.2 编写.gitlab-ci.yml")]),t._v(" "),a("blockquote",[a("p",[t._v("编写"),a("a",{attrs:{href:""}},[t._v(".gitlab-ci.yml")]),t._v("文件")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("stages:\n  - test\n\ntest:\n  stage: test\n  script:\n    - echo first test ci   # 输入的命令\n")])])]),a("h5",{attrs:{id:"_11-5-3-将maven工程推送到gitlab中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-3-将maven工程推送到gitlab中"}},[t._v("#")]),t._v(" 11.5.3 将maven工程推送到gitlab中")]),t._v(" "),a("blockquote",[a("p",[t._v("执行git命令推送到Gitlab")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push origin master\n")])])]),a("h5",{attrs:{id:"_11-5-4-查看效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-4-查看效果"}},[t._v("#")]),t._v(" 11.5.4 查看效果")]),t._v(" "),a("blockquote",[a("p",[t._v("可以在gitlab中查看到gitlab-ci.yml编写的内容")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("效果图")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214156.png",alt:"1588671760385"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-6-完善项目配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-完善项目配置"}},[t._v("#")]),t._v(" 11.6 完善项目配置")]),t._v(" "),a("blockquote",[a("p",[t._v("添加Dockerfile以及docker-compose.yml， 并修改"),a("a",{attrs:{href:""}},[t._v(".gitlab-ci.yml")]),t._v("文件")])]),t._v(" "),a("h5",{attrs:{id:"_11-6-1-创建dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-1-创建dockerfile"}},[t._v("#")]),t._v(" 11.6.1 创建Dockerfile")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# Dockerfile\nFROM daocloud.io/library/tomcat:8.5.15-jre8\nCOPY testci.war /usr/local/tomcat/webapps\n")])])]),a("h5",{attrs:{id:"_11-6-2-创建docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-2-创建docker-compose-yml"}},[t._v("#")]),t._v(" 11.6.2 创建docker-compose.yml")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("testci")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" testci\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n")])])]),a("h5",{attrs:{id:"_11-6-3-修改-gitlab-ci-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-3-修改-gitlab-ci-yml"}},[t._v("#")]),t._v(" 11.6.3 修改.gitlab-ci.yml")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# ci.yml\nstages:\n  - test\n\ntest:\n  stage: test\n  script:\n    - echo first test ci\n    - /usr/local/maven/apache-maven-3.6.3/bin/mvn package\n    - cp target/testci-1.0-SNAPSHOT.war docker/testci.war\n    - docker-compose down\n    - docker-compose up -d --build\n    - docker rmi $(docker images -qf dangling=true)\n")])])]),a("h5",{attrs:{id:"_11-6-4-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-4-测试"}},[t._v("#")]),t._v(" 11.6.4 测试")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("测试效果")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214200.png",alt:"1588674040060"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-7-cd介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-7-cd介绍"}},[t._v("#")]),t._v(" 11.7 CD介绍")]),t._v(" "),a("blockquote",[a("p",[t._v("CD（持续交付，持续部署）")]),t._v(" "),a("p",[t._v("持续交付：将代码交付给专业的测试团队去测试")]),t._v(" "),a("p",[t._v("持续部署：可以直接将指定好tag的代码直接部署到生产环境中")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("CICD图")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214203.png",alt:"1588677492583"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-8-安装jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-8-安装jenkins"}},[t._v("#")]),t._v(" 11.8 安装Jenkins")]),t._v(" "),a("h5",{attrs:{id:"_11-8-1-编写docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-8-1-编写docker-compose-yml"}},[t._v("#")]),t._v(" 11.8.1 编写docker-compose.yml")]),t._v(" "),a("blockquote",[a("p",[t._v("官网：https://www.jenkins.io/")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jenkins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jenkins/jenkins\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jenkins\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 50000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/jenkins_home\n")])])]),a("h5",{attrs:{id:"_11-8-2-运行并访问jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-8-2-运行并访问jenkins"}},[t._v("#")]),t._v(" 11.8.2 运行并访问Jenkins")]),t._v(" "),a("blockquote",[a("p",[t._v("第一次运行时，会因为data目录没有权限，导致启动失败")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("chmod 777 data\n")])])]),a("blockquote",[a("p",[t._v("访问http://192.168.199.109:8888")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("访问速度奇慢无比。。。。。\n")])])]),a("blockquote",[a("p",[t._v("访问成功后，需要输入密码，可在日志中查看")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214210.png",alt:"1588679573467"}})]),t._v(" "),a("blockquote",[a("p",[t._v("手动指定插件安装：指定下面两个插件即可")]),t._v(" "),a("p",[t._v("publish ssh.")]),t._v(" "),a("p",[t._v("git param.")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214212.png",alt:"1588679653006"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装成功后，需要指定上用户名和密码，登陆成功")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214218.png",alt:"1588681196639"}})]),t._v(" "),a("h4",{attrs:{id:"_11-9-配置jenkins的目标服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-9-配置jenkins的目标服务器"}},[t._v("#")]),t._v(" 11.9 配置Jenkins的目标服务器")]),t._v(" "),a("blockquote",[a("p",[t._v("执行过程为代码提交到Gitlab，Jenkins会从Gitlab中拉取代码，并在Jenkins中打包并发布到目标服务器中。")])]),t._v(" "),a("h5",{attrs:{id:"_11-9-1-点击左侧的系统设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-9-1-点击左侧的系统设置"}},[t._v("#")]),t._v(" 11.9.1 点击左侧的系统设置")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("左侧导航")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214229.png",alt:"1588681954779"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-9-2-选中中间区域的系统设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-9-2-选中中间区域的系统设置"}},[t._v("#")]),t._v(" 11.9.2 选中中间区域的系统设置")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("系统设置")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214232.png",alt:"1588681970621"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-9-3-搜索publish-over-ssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-9-3-搜索publish-over-ssh"}},[t._v("#")]),t._v(" 11.9.3 搜索Publish over SSH")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Publish over SSH")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214235.png",alt:"1588682011820"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-9-4-点击上图新增"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-9-4-点击上图新增"}},[t._v("#")]),t._v(" 11.9.4 点击上图新增")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("新增SSH连接")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214239.png",alt:"1588682092002"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-10-配置gitlab免密码登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-10-配置gitlab免密码登录"}},[t._v("#")]),t._v(" 11.10 配置GitLab免密码登录")]),t._v(" "),a("blockquote",[a("p",[t._v("链接Gitlab需要使用密码，我们可以通过SSH的方式，免密码登陆Gitlab拉取代码，避免每次都输入密码。")])]),t._v(" "),a("h5",{attrs:{id:"_11-10-1登录jenkins容器内部"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-10-1登录jenkins容器内部"}},[t._v("#")]),t._v(" 11.10.1登录Jenkins容器内部")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker exec -it jenkins bash\n")])])]),a("h5",{attrs:{id:"_11-10-2-输入生成ssh秘钥命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-10-2-输入生成ssh秘钥命令"}},[t._v("#")]),t._v(" 11.10.2 输入生成SSH秘钥命令")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('ssh-keygen -t rsa -C "邮箱（随便写）"\n')])])]),a("h5",{attrs:{id:"_11-10-3将秘钥复制到gitlab的ssh中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-10-3将秘钥复制到gitlab的ssh中"}},[t._v("#")]),t._v(" 11.10.3将秘钥复制到GitLab的SSH中")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("配置密钥")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214254.png",alt:"1588683585249"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-11-配置jdk和maven"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-11-配置jdk和maven"}},[t._v("#")]),t._v(" 11.11 配置JDK和Maven")]),t._v(" "),a("blockquote",[a("p",[t._v("我们需要再Jenkins中将代码打包，需要依赖JDK和Maven的环境")])]),t._v(" "),a("h5",{attrs:{id:"_11-11-1-复制软件到data目录下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-11-1-复制软件到data目录下"}},[t._v("#")]),t._v(" 11.11.1 复制软件到data目录下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("效果")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214257.png",alt:"1588684490466"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-11-2-在监控界面中配置jdk和maven"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-11-2-在监控界面中配置jdk和maven"}},[t._v("#")]),t._v(" 11.11.2 在监控界面中配置JDK和Maven")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("配置环境变量")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214301.png",alt:"1588684458028"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-11-3-手动拉取gitlab项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-11-3-手动拉取gitlab项目"}},[t._v("#")]),t._v(" 11.11.3 手动拉取gitlab项目")]),t._v(" "),a("blockquote",[a("p",[t._v("使用SSH无密码连接时，第一次连接需要手动确定")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("手动拉取一次")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214305.png",alt:"1588685220324"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-12-创建maven任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-12-创建maven任务"}},[t._v("#")]),t._v(" 11.12 创建maven任务")]),t._v(" "),a("blockquote",[a("p",[t._v("实现通过Jenkins的Maven任务，自动去Gitlab拉取代码，并在本地打包，发布到目标服务器上")])]),t._v(" "),a("h5",{attrs:{id:"_11-12-1-创建maven工程-推送到gitlab中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-12-1-创建maven工程-推送到gitlab中"}},[t._v("#")]),t._v(" 11.12.1 创建maven工程，推送到GitLab中")]),t._v(" "),a("blockquote",[a("p",[t._v("随便创建一个即可……")])]),t._v(" "),a("h5",{attrs:{id:"_11-12-2-jenkins的监控页面中创建maven任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-12-2-jenkins的监控页面中创建maven任务"}},[t._v("#")]),t._v(" 11.12.2 Jenkins的监控页面中创建maven任务")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("指定GitLab地址")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214309.png",alt:"1588686481506"}})])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("指定maven打包方式")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214317.png",alt:"1588686489821"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-12-3-执行maven任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-12-3-执行maven任务"}},[t._v("#")]),t._v(" 11.12.3 执行maven任务")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("立即构建，并查看日志")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214313.png",alt:"1588686591351"}})])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("控制台查看日志信息")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214330.png",alt:"1588686553880"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-12-4-最终效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-12-4-最终效果"}},[t._v("#")]),t._v(" 11.12.4 最终效果")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("打包成功")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214334.png",alt:"1588687382594"}})])])])]),t._v(" "),a("h4",{attrs:{id:"_11-13-实现持续交付持续部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-13-实现持续交付持续部署"}},[t._v("#")]),t._v(" 11.13 实现持续交付持续部署")]),t._v(" "),a("blockquote",[a("p",[t._v("实现根据tag标签，实现持续交付和持续部署")])]),t._v(" "),a("h5",{attrs:{id:"_11-13-1-安装persistent-parameter的插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-13-1-安装persistent-parameter的插件"}},[t._v("#")]),t._v(" 11.13.1 安装Persistent Parameter的插件")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("安装插件")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214337.png",alt:"1588693533099"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-13-2-重新指定构建项目的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-13-2-重新指定构建项目的方式"}},[t._v("#")]),t._v(" 11.13.2 重新指定构建项目的方式")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("根据标签构建项目")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214339.png",alt:"1588696879059"}})])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("自定义构建")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214344.png",alt:"1588697752850"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-13-3-构建项目成功后-需要将内容发布到目标服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-13-3-构建项目成功后-需要将内容发布到目标服务器"}},[t._v("#")]),t._v(" 11.13.3 构建项目成功后，需要将内容发布到目标服务器")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("发布服务器后执行的命令")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214349.png",alt:"1588697770621"}})])])])]),t._v(" "),a("h5",{attrs:{id:"_11-13-4-添加程序代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-13-4-添加程序代码"}},[t._v("#")]),t._v(" 11.13.4 添加程序代码")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Dockerfile 文件")]),t._v("\nFROM daocloud.io/library/tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8.5.15"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("jre8\nCOPY testcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SNAPSHOT.war /usr/local/tomcat/webapps\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yml文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("testcd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" testcd\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8081"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n")])])]),a("h5",{attrs:{id:"_11-13-5-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-13-5-测试"}},[t._v("#")]),t._v(" 11.13.5 测试")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("根据标签修改发布版本")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/zouyu0310/images/raw/master/img/20210527214355.png",alt:"1588700462690"}})])])])]),t._v(" "),a("p",[t._v("，")])])}),[],!1,null,null,null);a.default=r.exports}}]);