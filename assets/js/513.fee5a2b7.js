(window.webpackJsonp=window.webpackJsonp||[]).push([[513],{1192:function(s,t,a){"use strict";a.r(t);var r=a(14),e=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"主节点异常情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主节点异常情况"}},[s._v("#")]),s._v(" 主节点异常情况")]),s._v(" "),t("h3",{attrs:{id:"原有的master挂了"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原有的master挂了"}},[s._v("#")]),s._v(" 原有的master挂了")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("我们自己手动关闭6379服务器，模拟master挂了")])]),s._v(" "),t("li",[t("p",[s._v("问题思考")]),s._v(" "),t("ol",[t("li",[s._v("两台从机数据是否OK")]),s._v(" "),t("li",[s._v("是否会从剩下的2台机器上选出新的master")]),s._v(" "),t("li",[s._v("之前down机的master机器重启回来，谁将会是新老大？会不会双master冲突")])])]),s._v(" "),t("li",[t("p",[s._v("揭晓答案")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("两台从机数据OK")]),s._v(" "),t("p",[s._v("![](images/14.Broken Pipe.png)")])]),s._v(" "),t("li",[t("p",[s._v("会投票选出新的master主机")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/15.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("谁是master，限本次案例")]),s._v(" "),t("p",[s._v("本案例中6381被选举为新的master，上位成功")]),s._v(" "),t("p",[s._v("重启6379之后，它会从原来的master降级为slave")]),s._v(" "),t("p",[s._v("6380还是slave，只不过是换了一个新老大6381(从跟随6379变成跟随6381)")])])])])]),s._v(" "),t("h3",{attrs:{id:"对比配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对比配置文件"}},[s._v("#")]),s._v(" 对比配置文件")]),s._v(" "),t("p",[s._v("老master的redis6379.conf文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/16.jpg",alt:""}})]),s._v(" "),t("p",[s._v("新master的redis6381.conf文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/17.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"结论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[s._v("#")]),s._v(" 结论")]),s._v(" "),t("p",[t("strong",[s._v("文件的内容，在运行期间会被sentinel动态进行更改")])]),s._v(" "),t("p",[t("strong",[s._v("Master-Slave切换后，master_redis.conf、slave_redis.conf、sentinel.conf的内容都会发生改\\变，即master_redis.conf中会多一行slaveof的配置，而升级为master的主机会去掉原来的slaveof配置，\\sentinel.conf的监控目标会随之调换")])]),s._v(" "),t("h3",{attrs:{id:"其他备注"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他备注"}},[s._v("#")]),s._v(" 其他备注")]),s._v(" "),t("p",[s._v("生产上都是不同机房不同服务器，很少出现3个哨兵全部挂掉的情况")]),s._v(" "),t("p",[s._v("可以同时金童多个master，一行一个")]),s._v(" "),t("p",[t("img",{attrs:{src:"images/18.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);