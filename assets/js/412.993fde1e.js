(window.webpackJsonp=window.webpackJsonp||[]).push([[412],{1037:function(e,r,t){"use strict";t.r(r);var a=t(14),o=Object(a.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"一、rocketmq部署架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一、rocketmq部署架构"}},[e._v("#")]),e._v(" 一、rocketMQ部署架构")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/krislinzhao/IMGcloud/img/20200506132452.png",alt:""}})]),e._v(" "),r("ol",[r("li",[e._v("NameServer：消息队列的大脑，同时监控消息队列，存储关于队列的基本信息，如各个队列的分布，ip、服务地址、目前的健康状况、队列的处理进度等。多个Nmaeserver之间没有通信。")]),e._v(" "),r("li",[e._v("broker：队列服务，负责接受请求并分发请求。数据存储、消息分发的负载均衡。可以是master-slave的主从结构。")]),e._v(" "),r("li",[e._v("console-ng：消息队列的监控控制台")])]),e._v(" "),r("h1",{attrs:{id:"二、安装nameserver和broker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二、安装nameserver和broker"}},[e._v("#")]),e._v(" 二、安装nameserver和broker")]),e._v(" "),r("blockquote",[r("p",[e._v("注意：安装rocketMQ，虚拟机磁盘空间要足够。最小10G空余磁盘空间为好。")])]),e._v(" "),r("p",[e._v("下载rocketMQ镜像")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("docker pull rocketmqinc/rocketmq\n")])])]),r("p",[e._v("新建本机数据存储文件夹")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("rm -fR /home/rocketmq/data/;\nmkdir -p /home/rocketmq/data/namesrv/{logs,store};\nmkdir -p /home/rocketmq/data/broker/{logs,store,conf};\n")])])]),r("p",[e._v("启动nameserver")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('docker run -d -p 9876:9876 \\\n-v /home/rocketmq/data/namesrv/logs:/root/logs \\\n-v /home/rocketmq/data/namesrv/store:/root/store \\\n--name rmqnamesrv \\\n-e "MAX_POSSIBLE_HEAP=256000000" \\\nrocketmqinc/rocketmq  sh mqnamesrv\n')])])]),r("p",[e._v("将以下配置文件放入本机目录/home/rocketmq/data/broker/conf/broker.conf")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("brokerClusterName = DefaultCluster\nbrokerName = broker-a\nbrokerId = 0\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n#修改这个ip为你的物理主机ip\nbrokerIP1=192.168.18.137\n")])])]),r("p",[e._v("参考第四小节内容，先把防火墙的9876端口开放，启动broker")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('docker run -d -p 10911:10911 -p 10909:10909 \\\n-v /home/rocketmq/data/broker/logs:/root/logs \\\n-v /home/rocketmq/data/broker/store:/root/store \\\n-v /home/rocketmq/data/broker/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \\\n--name rmqbroker --link rmqnamesrv:namesrv \\\n-e "NAMESRV_ADDR=namesrv:9876" \\\n-e "MAX_POSSIBLE_HEAP=256000000" \\\nrocketmqinc/rocketmq sh mqbroker   -c /opt/rocketmq-4.4.0/conf/broker.conf\n')])])]),r("h1",{attrs:{id:"三、rocketmq控制台"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三、rocketmq控制台"}},[e._v("#")]),e._v(" 三、RocketMQ控制台")]),e._v(" "),r("ol",[r("li",[e._v("拉取镜像")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v(" docker pull styletang/rocketmq-console-ng\n")])])]),r("ol",[r("li",[e._v("创建container，并启动")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('docker run -d \\\n-e "JAVA_OPTS=-Drocketmq.namesrv.addr=172.17.0.2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false" \\\n-p 8999:8080 -t styletang/rocketmq-console-ng\n')])])]),r("p",[e._v("因为服务器的8080端口经常冲突，我们使用8999端口提供控制台容器服务")]),e._v(" "),r("blockquote",[r("p",[e._v("特别注意")]),e._v(" "),r("ol",[r("li",[e._v("必须先启动"),r("code",[e._v("namesrv")]),e._v("，再启动"),r("code",[e._v("broker")]),e._v("，否则报错")]),e._v(" "),r("li",[e._v("创建控制台的container时，"),r("code",[e._v("-Drocketmq.namesrv.addr")]),e._v("必须指定为"),r("code",[e._v("namesrv")]),e._v("所在container的IP")])])]),e._v(" "),r("p",[e._v("可以通过以下命令来查看每个container的IP地址")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("docker inspect --format='{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' $(docker ps -aq)\n")])])]),r("h1",{attrs:{id:"四、防火墙开放端口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四、防火墙开放端口"}},[e._v("#")]),e._v(" 四、防火墙开放端口")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("firewall-cmd --zone=public --add-port=9876/tcp --permanent\nfirewall-cmd --zone=public --add-port=10911/tcp --permanent\nfirewall-cmd --zone=public --add-port=10909/tcp --permanent\nfirewall-cmd --zone=public --add-port=8999/tcp --permanent\nfirewall-cmd --reload\n\n#查看是否开放端口\n\nfirewall-cmd --query-port=9876/tcp\nfirewall-cmd --query-port=10911/tcp\nfirewall-cmd --query-port=10909/tcp\nfirewall-cmd --query-port=8999/tcp\n")])])]),r("p",[e._v("访问http://192.168.18.137:8999")])])}),[],!1,null,null,null);r.default=o.exports}}]);