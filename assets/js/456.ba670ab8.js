(window.webpackJsonp=window.webpackJsonp||[]).push([[456],{1115:function(e,t,n){"use strict";n.r(t);var a=n(14),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"_71-gateway配置动态路由"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_71-gateway配置动态路由"}},[e._v("#")]),e._v(" 71_GateWay配置动态路由")]),e._v(" "),t("p",[e._v("默认情况下Gateway会根据注册中心注册的服务列表，以注册中心上微服务名为路径创建"),t("strong",[e._v("动态路由进行转发，从而实现动态路由的功能")]),e._v("（不写死一个地址）。")]),e._v(" "),t("p",[t("strong",[e._v("启动")])]),e._v(" "),t("ul",[t("li",[e._v("eureka7001")]),e._v(" "),t("li",[e._v("payment8001/8002")])]),e._v(" "),t("p",[t("strong",[e._v("POM")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\x3c!--eureka-client--\x3e\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n</dependency>\n\n")])])]),t("p",[t("strong",[e._v("YML")])]),e._v(" "),t("p",[e._v("需要注意的是uri的协议为lb，表示启用Gateway的负载均衡功能。")]),e._v(" "),t("p",[e._v("lb://serviceName是spring cloud gateway在微服务中自动为我们创建的负载均衡uri。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("server:\n  port: 9527\n\nspring:\n  application:\n    name: cloud-gateway\n  #############################新增网关配置###########################\n  cloud:\n    gateway:\n      discovery:\n        locator:\n          enabled: true   #开启从注册中心动态创建路由的功能，利用微服务名进行路由\n      routes: #路由多个\n        - id: payment_routh #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名\n#          uri: http://localhost:8001          #匹配后提供服务的路由地址\n          uri: lb://cloud-payment-service #匹配后提供服务的路由地址\n          predicates:\n            - Path=/payment/get/**         # 断言，路径相匹配的进行路由(相应方法)\n\n        - id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名\n#          uri: http://localhost:8001          #匹配后提供服务的路由地址\n          uri: lb://cloud-payment-service #匹配后提供服务的路由地址\n          predicates:\n            - Path=/payment/lb/**         # 断言，路径相匹配的进行路由\n####################################################################\n\n\neureka:\n  instance:\n    hostname: cloud-gateway-service\n  client: #服务提供者provider注册进eureka服务列表内\n    service-url:\n      register-with-eureka: true\n      fetch-registry: true\n      defaultZone: http://eureka7001.com:7001/eureka\n\n")])])]),t("p",[t("strong",[e._v("测试")])]),e._v(" "),t("p",[e._v("浏览器输入 - http://localhost:9527/payment/lb")]),e._v(" "),t("p",[e._v("结果")]),e._v(" "),t("p",[e._v("不停刷新页面，8001/8002两个端口切换。")])])}),[],!1,null,null,null);t.default=r.exports}}]);