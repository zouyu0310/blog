(window.webpackJsonp=window.webpackJsonp||[]).push([[436],{1077:function(n,e,a){"use strict";a.r(e);var t=a(14),r=Object(t.a)({},(function(){var n=this,e=n._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"_39-ribbon负载规则替换"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_39-ribbon负载规则替换"}},[n._v("#")]),n._v(" 39_Ribbon负载规则替换")]),n._v(" "),e("p",[n._v("1.修改cloud-consumer-order80")]),n._v(" "),e("p",[n._v("2.注意配置细节")]),n._v(" "),e("p",[n._v("官方文档明确给出了警告:")]),n._v(" "),e("p",[n._v("这个自定义配置类不能放在@ComponentScan所扫描的当前包下以及子包下，")]),n._v(" "),e("p",[n._v("否则我们自定义的这个配置类就会被所有的Ribbon客户端所共享，达不到特殊化定制的目的了。")]),n._v(" "),e("p",[n._v("（也就是说不要将Ribbon配置类与主启动类同包）")]),n._v(" "),e("p",[n._v("3.新建package - com.myrule")]),n._v(" "),e("p",[n._v("4.在com.myrule下新建MySelfRule规则类")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("/**\n * @ClassName MySelfRule\n * @Description ribbon 更换负载均衡规则类\n * @Author zouyu\n * @Date 2021/12/26 20:46\n * @Version 1.0\n **/\n@Configuration\npublic class MySelfRule {\n\n    @Bean\n    public IRule myRule(){\n        //定义为随机\n        return new RandomRule();\n    }\n}\n")])])]),e("p",[n._v("5.主启动类添加@RibbonClient")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@SpringBootApplication\n@EnableEurekaClient\n\n//添加到此处  name说明: 80要去访问支付微服务\n@RibbonClient(name = "CLOUD-PAYMENT-SERVICE", configuration = MySelfRule.class)\npublic class OrderMain80 {\n    public static void main(String[] args){\n        SpringApplication.run(OrderMain80.class,args);\n        System.out.println("80服务启动成功!");\n    }\n}\n')])])]),e("p",[n._v("6.测试")]),n._v(" "),e("p",[n._v("开启cloud-eureka-server7001，cloud-consumer-order80，cloud-provider-payment8001，cloud-provider-payment8002")]),n._v(" "),e("p",[n._v("浏览器-输入http://localhost/consumer/payment/get/1")]),n._v(" "),e("p",[n._v("返回结果中的serverPort在8001与8002两种间反复横跳。而且结果没有规律")])])}),[],!1,null,null,null);e.default=r.exports}}]);