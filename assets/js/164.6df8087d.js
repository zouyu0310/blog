(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{754:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql应用优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql应用优化"}},[t._v("#")]),t._v(" MySQL应用优化")]),t._v(" "),a("h2",{attrs:{id:"_4-1-mysql索引优化与设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-mysql索引优化与设计"}},[t._v("#")]),t._v(" 4.1-MySQL索引优化与设计")]),t._v(" "),a("h3",{attrs:{id:"什么是索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是索引"}},[t._v("#")]),t._v(" 什么是索引")]),t._v(" "),a("ul",[a("li",[t._v("索引的意义 —— 快速定位要查找的数据")])]),t._v(" "),a("h3",{attrs:{id:"数据库索引查找"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库索引查找"}},[t._v("#")]),t._v(" 数据库索引查找")]),t._v(" "),a("ul",[a("li",[t._v("全表扫描 VS 索引查找")])]),t._v(" "),a("h3",{attrs:{id:"如何根据首字母找到所在行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何根据首字母找到所在行"}},[t._v("#")]),t._v(" 如何根据首字母找到所在行")]),t._v(" "),a("ul",[a("li",[t._v("二分查找")]),t._v(" "),a("li",[t._v("B+tree")])]),t._v(" "),a("h3",{attrs:{id:"innodb表聚簇索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#innodb表聚簇索引"}},[t._v("#")]),t._v(" InnoDB表聚簇索引")]),t._v(" "),a("p",[t._v("索引中只放着排序字段和ID")]),t._v(" "),a("h3",{attrs:{id:"创建索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建索引"}},[t._v("#")]),t._v(" 创建索引")]),t._v(" "),a("ul",[a("li",[t._v("单列索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" idx_test1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" tb_student "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("联合索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" idx_test2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" tb_student "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("索引中先根据name排序，name相同的情况下，根据age排序")])]),t._v(" "),a("h3",{attrs:{id:"索引维护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引维护"}},[t._v("#")]),t._v(" 索引维护")]),t._v(" "),a("ul",[a("li",[t._v("索引维护由数据库自动完成")]),t._v(" "),a("li",[t._v("插入/修改/删除每一个索引行都会变成一个内部封装的事务")]),t._v(" "),a("li",[t._v("索引越多，事务越长，代价越高")]),t._v(" "),a("li",[t._v("索引越多对表的插入和索引字段修改就越慢")]),t._v(" "),a("li",[t._v("控制表上索引的数量，切忌胡乱添加无用索引")])]),t._v(" "),a("h3",{attrs:{id:"如何使用索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何使用索引"}},[t._v("#")]),t._v(" 如何使用索引")]),t._v(" "),a("ul",[a("li",[t._v("依据WHERE查询条件建立索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tab_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nidx_c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tab_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nidx_cd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("排序order by, group by, distinct字段添加索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tb_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tb_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nidx_a "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tb_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nidx_a_b "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tb_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nidx_c_a "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"索引与字段选择性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引与字段选择性"}},[t._v("#")]),t._v(" 索引与字段选择性")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("某个字段其值的重复程度")])]),t._v(" "),a("li",[a("p",[t._v("选择性很差的字段通常不适合创建单列索引")]),t._v(" "),a("ul",[a("li",[t._v("男女比例相仿的列表中性别不适合创建单列索引")]),t._v(" "),a("li",[t._v("如果男女比例极不平衡，要查询的又是少数方(理工院校查女生)可以考虑使用索引")])])]),t._v(" "),a("li",[a("p",[t._v("联合索引中选择性好的字段应该排在前面")])])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tab_a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" gender"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nidx_a1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"联合索引与前缀查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联合索引与前缀查询"}},[t._v("#")]),t._v(" 联合索引与前缀查询")]),t._v(" "),a("ul",[a("li",[t._v("联合索引能为前缀单列，复列查询提供帮助")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("idx_smp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("部分ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("合理创建联合索引，避免冗余\n(a) , (a, b) , (a, b, c) X\n(a, b, c) ok")])]),t._v(" "),a("h3",{attrs:{id:"长字段上的索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#长字段上的索引"}},[t._v("#")]),t._v(" 长字段上的索引")]),t._v(" "),a("ul",[a("li",[t._v("在非常长的字段上建立索引影响性能")]),t._v(" "),a("li",[t._v("InnoDB索引单字段(utf8)只能取前767 bytes")]),t._v(" "),a("li",[t._v("对长字段处理的方法\n"),a("ul",[a("li",[t._v("Email类，建立前缀索引")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("Mail_addr "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nidx_mailadd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Mail_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ok\n")])])]),a("ul",[a("li",[t._v("住址类，拆分字段")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("Home_address "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nidx_mailadd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Mail_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ? "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 很可能前半段都是相同的省市区街道名称")]),t._v("\nProvince "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" City "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" District "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Local_address "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 建立联合索引或单列索引")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"索引覆盖扫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引覆盖扫"}},[t._v("#")]),t._v(" 索引覆盖扫")]),t._v(" "),a("ul",[a("li",[t._v("最核心SQL考虑索引覆盖"),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" Name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tb_user "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" UserID"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("?\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Key")]),t._v(" idx_uid_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("不需要回表获取name字段，IO最小，效率最高")])]),t._v(" "),a("h3",{attrs:{id:"无法使用索引的情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#无法使用索引的情况"}},[t._v("#")]),t._v(" 无法使用索引的情况")]),t._v(" "),a("ul",[a("li",[t._v("索引列进行数学运算或函数运算"),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" X\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ok\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("year")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("col"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2007")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" X\ncol "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2007-01-01'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ok\n")])])])]),t._v(" "),a("li",[t._v("未含符合索引的前缀字段"),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("Idx_abc "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("? "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" X\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ok\n")])])])]),t._v(" "),a("li",[t._v("前缀通配,'_'和'%'通配符"),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("Like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%xxx%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" X\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("Like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ok\n")])])])]),t._v(" "),a("li",[t._v("where 条件使用NOT, <>, !=")]),t._v(" "),a("li",[t._v("字段类型匹配\n"),a("ul",[a("li",[t._v("并不绝对，但是无法预测地会造成问题，不要使用")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" idx_a "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" X\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ok\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"利用索引排序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用索引排序"}},[t._v("#")]),t._v(" 利用索引排序")]),t._v(" "),a("p",[t._v("idx_a_b (a, b)")]),t._v(" "),a("ul",[a("li",[t._v("能够使用索引帮助排序的查询：")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a\na "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" b\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\na "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a\n")])])]),a("ul",[a("li",[t._v("不能使用索引帮助排序的查询：")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" b\na "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" b\na "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" b\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("asc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\n")])])]),a("h3",{attrs:{id:"如何确定一个查询走没走索引-走了哪个索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何确定一个查询走没走索引-走了哪个索引"}},[t._v("#")]),t._v(" 如何确定一个查询走没走索引，走了哪个索引")]),t._v(" "),a("ul",[a("li",[t._v("explain是确定一个查询如何走索引最简便有效的方法\n"),a("code",[t._v("explain select * from tb_test ;")])]),t._v(" "),a("li",[t._v("关注的项目\n"),a("ul",[a("li",[t._v("type:查询access的方式")]),t._v(" "),a("li",[t._v("key:本次查询最终选择使用哪个索引，NULL为未使用索引")]),t._v(" "),a("li",[t._v("key_len:选择的索引使用的前缀长度或者整个长度")]),t._v(" "),a("li",[t._v("rows:可以理解为查询逻辑读，需要扫描过的记录行数")]),t._v(" "),a("li",[t._v("extra:额外信息，主要指的fetch data的具体方式")])])])]),t._v(" "),a("h2",{attrs:{id:"_4-2-mysql数据库设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-mysql数据库设计"}},[t._v("#")]),t._v(" 4.2-MySQL数据库设计")]),t._v(" "),a("h3",{attrs:{id:"什么是schema设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是schema设计"}},[t._v("#")]),t._v(" 什么是Schema设计")]),t._v(" "),a("ul",[a("li",[t._v("设计数据库的表，索引，以及表和表的关系\n"),a("ul",[a("li",[t._v("在数据模型的基础上将关系模型转化为数据库表")]),t._v(" "),a("li",[t._v("满足业务模型需要基础上根据数据库和应用特点优化表结构")])])])]),t._v(" "),a("h3",{attrs:{id:"为什么schema需要设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么schema需要设计"}},[t._v("#")]),t._v(" 为什么Schema需要设计")]),t._v(" "),a("ul",[a("li",[t._v("Schema关系到应用程序功能与性能\n"),a("ul",[a("li",[t._v("满足业务功能需要")]),t._v(" "),a("li",[t._v("同性能密切相关")]),t._v(" "),a("li",[t._v("数据库扩展性")]),t._v(" "),a("li",[t._v("满足周边需求(统计，迁移等)")])])]),t._v(" "),a("li",[t._v("关系型数据库修改Schema经常是高危操作\n"),a("ul",[a("li",[t._v("Schema设计要体现一定的前瞻性")])])])]),t._v(" "),a("h3",{attrs:{id:"完全由开发者主导的schema设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完全由开发者主导的schema设计"}},[t._v("#")]),t._v(" 完全由开发者主导的Schema设计")]),t._v(" "),a("ul",[a("li",[t._v("着眼于实现当前功能")]),t._v(" "),a("li",[t._v("完全基于功能的设计可能存在一些隐患\n"),a("ul",[a("li",[t._v("不合理的表结构或索引设计造成性能问题")]),t._v(" "),a("li",[t._v("没有合理评估到数据量的增长造成空间紧张而且难以维护")]),t._v(" "),a("li",[t._v("需求频繁修改造成表结构经常变更")]),t._v(" "),a("li",[t._v("业务重大调整导致数据经常需要重构订正")])])])]),t._v(" "),a("h3",{attrs:{id:"基于性能的表设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于性能的表设计"}},[t._v("#")]),t._v(" 基于性能的表设计")]),t._v(" "),a("ul",[a("li",[t._v("根据查询需要设计好索引")]),t._v(" "),a("li",[t._v("根据核心查询需求，适当调整表结构")]),t._v(" "),a("li",[t._v("基于一些特殊业务需求，调整实现方式")])]),t._v(" "),a("h3",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("ul",[a("li",[t._v("正确使用索引")]),t._v(" "),a("li",[t._v("更新尽可能使用主键或唯一索引")]),t._v(" "),a("li",[t._v("主键尽可能使用自增ID字段")]),t._v(" "),a("li",[t._v("核心查询覆盖扫描\n"),a("ul",[a("li",[t._v("用户登录需要根据用户名返回密码用于验证"),a("code",[t._v("create index idx_uname_passwd on tb_user (username, password);")])]),t._v(" "),a("li",[t._v("建立联合索引避免回表取数据")])])])]),t._v(" "),a("h3",{attrs:{id:"反范式-冗余必要字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反范式-冗余必要字段"}},[t._v("#")]),t._v(" 反范式，冗余必要字段")]),t._v(" "),a("ul",[a("li",[t._v("针对核心SQL保留查询结果所必须的冗余字段，避免频繁join\n"),a("ul",[a("li",[t._v("例：消息表中冗余了每次读消息必须返回的nickname字段，避免每次读消息都变成join操作。代价是用户修改nickname成本变高。")])])])]),t._v(" "),a("h3",{attrs:{id:"拆分大字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拆分大字段"}},[t._v("#")]),t._v(" 拆分大字段")]),t._v(" "),a("ul",[a("li",[t._v("拆分大字段到单独表中，避免范围扫描代价大\n"),a("ul",[a("li",[t._v("例：博文表拆分两份，标题表只保留标题和内容缩略部分，用于快速批量返回标题列表，正文表保存大段博文内容，用于点开文章单个读取")])])])]),t._v(" "),a("h3",{attrs:{id:"避免过多字段或过长行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免过多字段或过长行"}},[t._v("#")]),t._v(" 避免过多字段或过长行")]),t._v(" "),a("ul",[a("li",[t._v("根据SQL必要返回设计字段，有必要就拆表，避免过多字段")]),t._v(" "),a("li",[t._v("一次没有必要获取那么多列数据")]),t._v(" "),a("li",[t._v("行过长导致表数据页记录变少，范围扫描性能降低")]),t._v(" "),a("li",[t._v("更新数据也代价增加")]),t._v(" "),a("li",[t._v("16K也最少放2行，可能出现行迁移")])]),t._v(" "),a("h3",{attrs:{id:"分页查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分页查询"}},[t._v("#")]),t._v(" 分页查询")]),t._v(" "),a("ul",[a("li",[t._v("避免limit + offset过大")]),t._v(" "),a("li",[t._v("应该使用自增主键ID模拟分页\n"),a("ul",[a("li",[t._v("第一页，直接查")]),t._v(" "),a("li",[t._v("得到第一页的max(id)=123(一般是最后一条记录)")]),t._v(" "),a("li",[t._v("第二页，带上id>123查询：where id>123 limit 100")]),t._v(" "),a("li",[t._v("这样每次只需要扫描100条数据")])])]),t._v(" "),a("li",[t._v("要求业务上禁止查询XX页之后的数据")])]),t._v(" "),a("h3",{attrs:{id:"热点读数据特殊处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#热点读数据特殊处理"}},[t._v("#")]),t._v(" 热点读数据特殊处理")]),t._v(" "),a("ul",[a("li",[t._v("根据数据获取的频率或数量不同对热点数据做特殊处理\n"),a("ul",[a("li",[t._v("例1：论坛系统中置顶帖、公告贴，可以单独拆分存储，由于每次访问都要全部读出来，单独放在一起，避免每次都到普通表中随机找出来")])])])]),t._v(" "),a("h3",{attrs:{id:"热点写数据特殊处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#热点写数据特殊处理"}},[t._v("#")]),t._v(" 热点写数据特殊处理")]),t._v(" "),a("ul",[a("li",[t._v("根据数据获取的频率或数量不同对热点数据做特殊处理\n"),a("ul",[a("li",[t._v('例2：微博系统中对于大量关注的热点账号消息从"推"改为"拉"，避免过量insert操作。')])])])]),t._v(" "),a("h3",{attrs:{id:"准实时统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准实时统计"}},[t._v("#")]),t._v(" 准实时统计")]),t._v(" "),a("ul",[a("li",[t._v("对不需要精确结果的计数等统计要求，建立定期更新结果表\n"),a("ul",[a("li",[t._v("例：首页要求展示动态成交总金额，维护一个计数表，每分钟根据原表注册时间获取增量sum值更新计数表，避免每次用户刷新都要扫描交易全记录表")])])])]),t._v(" "),a("h3",{attrs:{id:"实时统计改进1-触发器实时统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时统计改进1-触发器实时统计"}},[t._v("#")]),t._v(" 实时统计改进1 - 触发器实时统计")]),t._v(" "),a("ul",[a("li",[t._v("对需要精确统计的计数利用数据库触发器维护计数表\n"),a("ul",[a("li",[t._v("例：用户量冲亿活动要求实时统计，用户表上加触发器，每次有新用户插入就同时在计数表+1")])])])]),t._v(" "),a("h3",{attrs:{id:"实时统计改进2-缓存实时统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时统计改进2-缓存实时统计"}},[t._v("#")]),t._v(" 实时统计改进2 - 缓存实时统计")]),t._v(" "),a("ul",[a("li",[t._v("对需要精确统计的计数利用前端缓存实时维护计数\n"),a("ul",[a("li",[t._v("例：用户量冲亿活动要求实时统计，注册数量在缓存中实时维护，每注册一个就+1，完全避免数据库读写操作。缓存万一故障失效，可从数据库整体count重新获取。")])])])]),t._v(" "),a("h3",{attrs:{id:"实时统计改进2-最大自增id获取总数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时统计改进2-最大自增id获取总数"}},[t._v("#")]),t._v(" 实时统计改进2 - 最大自增ID获取总数")]),t._v(" "),a("ul",[a("li",[t._v("很多逻辑可以利用自增ID主键最大值直接作为总数\n"),a("ul",[a("li",[t._v("例：用户量冲亿活动要求实时统计，用户表加上自增ID作为主键，只要取当时max(ID)就可以得到用户总数")])])])]),t._v(" "),a("h3",{attrs:{id:"课拓展性设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#课拓展性设计"}},[t._v("#")]),t._v(" 课拓展性设计")]),t._v(" "),a("ul",[a("li",[t._v("可拓展性\n"),a("ul",[a("li",[t._v("硬件资源增长有极限的情况下处理尽可能久的线上业务")])])]),t._v(" "),a("li",[t._v("数据分级，冷数据归档与淘汰\n"),a("ul",[a("li",[t._v("可以不断释放空间供新数据使用")])])]),t._v(" "),a("li",[t._v("为数据分布式做准备\n"),a("ul",[a("li",[t._v("分库分表")]),t._v(" "),a("li",[t._v("水平拆分")]),t._v(" "),a("li",[t._v("牺牲一定的关系模型支持")])])])]),t._v(" "),a("h3",{attrs:{id:"分区表与数据淘汰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分区表与数据淘汰"}},[t._v("#")]),t._v(" 分区表与数据淘汰")]),t._v(" "),a("ul",[a("li",[t._v("range分区")]),t._v(" "),a("li",[t._v("适合数据需要定期过期的大表")]),t._v(" "),a("li",[t._v("单个分区扫描迁移数据到历史库避免全表扫描IO开销")]),t._v(" "),a("li",[t._v("删除单个分区非常高效")])]),t._v(" "),a("h3",{attrs:{id:"分区表与垂直分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分区表与垂直分区"}},[t._v("#")]),t._v(" 分区表与垂直分区")]),t._v(" "),a("ul",[a("li",[t._v("list分区")]),t._v(" "),a("li",[t._v("适合将来可能要基于地区，类目等方式垂直拆分数据的方式")]),t._v(" "),a("li",[t._v("清理节点上不要的数据非常高效")])]),t._v(" "),a("h3",{attrs:{id:"分区表与水平分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分区表与水平分区"}},[t._v("#")]),t._v(" 分区表与水平分区")]),t._v(" "),a("ul",[a("li",[t._v("hash分区")]),t._v(" "),a("li",[t._v("适合将来需要做水平拆分的表")]),t._v(" "),a("li",[t._v("清理节点上不要的数据非常高效")])]),t._v(" "),a("h3",{attrs:{id:"mysql分区表的局限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql分区表的局限"}},[t._v("#")]),t._v(" MySQL分区表的局限")]),t._v(" "),a("ul",[a("li",[t._v("主键或唯一键必须包含在分区字段内")]),t._v(" "),a("li",[t._v("分区字段必须是整数类型，或者加上返回整数的函数")])]),t._v(" "),a("h3",{attrs:{id:"满足周边需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#满足周边需求"}},[t._v("#")]),t._v(" 满足周边需求")]),t._v(" "),a("ul",[a("li",[t._v("为周边需求额外增加表设计\n"),a("ul",[a("li",[t._v("为后台统计任务增加特殊索引")]),t._v(" "),a("li",[t._v("为数据迁移或统计需求增加时间戳")])])])]),t._v(" "),a("h3",{attrs:{id:"统计和后台需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#统计和后台需求"}},[t._v("#")]),t._v(" 统计和后台需求")]),t._v(" "),a("ul",[a("li",[t._v("统计运行SQL往往和线上有很大不同\n"),a("ul",[a("li",[t._v("利用MySQL——主多从，主从可以建不同索引的特性将统计分流到特定从库")]),t._v(" "),a("li",[t._v("包括一些特殊用户批量查询等，所有对线上有IO压力的查询都要读写分离")])])])]),t._v(" "),a("h3",{attrs:{id:"自动更新时间戳"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动更新时间戳"}},[t._v("#")]),t._v(" 自动更新时间戳")]),t._v(" "),a("ul",[a("li",[t._v("统计需求经常要求从线上读走增量数据")]),t._v(" "),a("li",[t._v("表的第一个timestamp类型字段再写入时如果不填值，会自动写入系统时间戳")]),t._v(" "),a("li",[t._v("表的第一个timestamp类型字段每次记录发生更新后都会自动更新")]),t._v(" "),a("li",[t._v("在update_time字段上建索引用于定时导出增量数据")])]),t._v(" "),a("h3",{attrs:{id:"schema设计与前瞻性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#schema设计与前瞻性"}},[t._v("#")]),t._v(" Schema设计与前瞻性")]),t._v(" "),a("ul",[a("li",[t._v("基于历史经验教训，预防和解决同类问题")]),t._v(" "),a("li",[t._v("把折腾DBA够呛的所有Schema改造的原因记录并分析总结\n例：")]),t._v(" "),a("li",[t._v("业务为例用户信息加密做了大改造\n"),a("ul",[a("li",[t._v("数据库结果大量改动，增加了加密字段，验证策略表，所有表重新订正数据等等")]),t._v(" "),a("li",[t._v("是否所有用到用户信息管理的应用都要去上线就用密文？")])])]),t._v(" "),a("li",[t._v("程序bug误删数据，线上风险大\n"),a("ul",[a("li",[t._v("改造业务流程，不再删除数据，加入is_deleted标记位，经常给各种表加")]),t._v(" "),a("li",[t._v("今后的类似表是否一上线就都用标记位的方式，并加上修改原因字段？")])])]),t._v(" "),a("li",[t._v("支付类应用后期做了风控改造\n"),a("ul",[a("li",[t._v("对线上订单大表改造，加了限额，终端类型等字段")]),t._v(" "),a("li",[t._v("遇到支付类应用，是否一上线就提示业务是否需要考虑风控并留好相关字段？")])])])]),t._v(" "),a("h2",{attrs:{id:"_4-3-mysql容量评估"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-mysql容量评估"}},[t._v("#")]),t._v(" 4.3-MySQL容量评估")]),t._v(" "),a("h3",{attrs:{id:"性能容量评估"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能容量评估"}},[t._v("#")]),t._v(" 性能容量评估")]),t._v(" "),a("ul",[a("li",[t._v("分析线上业务场景")]),t._v(" "),a("li",[t._v("评估数据库服务器所需性能指标")]),t._v(" "),a("li",[t._v("预估可能成为瓶颈的服务器资源")]),t._v(" "),a("li",[t._v("帮助数据库性能调优")])]),t._v(" "),a("h3",{attrs:{id:"数据库服务器硬件性能指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库服务器硬件性能指标"}},[t._v("#")]),t._v(" 数据库服务器硬件性能指标")]),t._v(" "),a("ul",[a("li",[t._v("磁盘IO性能")]),t._v(" "),a("li",[t._v("内存容量")]),t._v(" "),a("li",[t._v("CPU")]),t._v(" "),a("li",[t._v("网络吞吐量")]),t._v(" "),a("li",[t._v("磁盘容量")])]),t._v(" "),a("h3",{attrs:{id:"数据库业务特点关键词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库业务特点关键词"}},[t._v("#")]),t._v(" 数据库业务特点关键词")]),t._v(" "),a("ul",[a("li",[t._v("OLTP/OLAP类型")]),t._v(" "),a("li",[t._v("并发请求")]),t._v(" "),a("li",[t._v("读写比例")]),t._v(" "),a("li",[t._v("数据量")]),t._v(" "),a("li",[t._v("冷热数据比")]),t._v(" "),a("li",[t._v("数据分级存储")])]),t._v(" "),a("h3",{attrs:{id:"oltp-olap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oltp-olap"}},[t._v("#")]),t._v(" OLTP/OLAP")]),t._v(" "),a("ul",[a("li",[t._v("T = Transaction")]),t._v(" "),a("li",[t._v("面向广大用户，高并发，较短事务操作")]),t._v(" "),a("li",[t._v("互联网应用绝大部分属于OLTP")]),t._v(" "),a("li",[t._v("OLTP看重服务器CPU，内存，写事务较多或内存不够则依赖磁盘IO")]),t._v(" "),a("li",[t._v("A = Analytical")]),t._v(" "),a("li",[t._v("通常面向内部人员，大规模复查询")]),t._v(" "),a("li",[t._v("OLAP看重磁盘扫描的IO能力，部分依赖内存排序")])]),t._v(" "),a("h3",{attrs:{id:"并发请求-衡量线上业务繁忙程度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#并发请求-衡量线上业务繁忙程度"}},[t._v("#")]),t._v(" 并发请求 - 衡量线上业务繁忙程度")]),t._v(" "),a("ul",[a("li",[t._v("业务高峰时数据库的每秒并发访问量是多少")]),t._v(" "),a("li",[t._v("通过应用服务器数量，连接池配置判断")]),t._v(" "),a("li",[t._v("通过产品估算初上线用户规模和用户增长速度判断")]),t._v(" "),a("li",[t._v("通过实际业务业务类型判断")]),t._v(" "),a("li",[t._v("并发量相关资源：CPU")])]),t._v(" "),a("h3",{attrs:{id:"读写比例-描述应用程序如何使用数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读写比例-描述应用程序如何使用数据库"}},[t._v("#")]),t._v(" 读写比例 - 描述应用程序如何使用数据库")]),t._v(" "),a("ul",[a("li",[t._v("线上业务select只读与update/delete/insert写操作比例")]),t._v(" "),a("li",[t._v("delete/update通常都是先读再写")]),t._v(" "),a("li",[t._v("insert需要区分数据写入时持续insert还是大量导入数据")]),t._v(" "),a("li",[t._v("根据业务实际场景分析")]),t._v(" "),a("li",[t._v("多读场景相关资源：内存")]),t._v(" "),a("li",[t._v("多写场景相关资源：磁盘IO")])]),t._v(" "),a("h3",{attrs:{id:"数据量-总量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据量-总量"}},[t._v("#")]),t._v(" 数据量 - 总量")]),t._v(" "),a("ul",[a("li",[t._v("数据库服务器存储设备可扩容能力的上限")]),t._v(" "),a("li",[t._v("根据估算的业务量，写入模式，分析数据增长量")]),t._v(" "),a("li",[t._v("预估一个硬件升级周期内数据库可存放数据的总量，上线时要留好余量")]),t._v(" "),a("li",[t._v("数据总量相关资源：磁盘容量")])]),t._v(" "),a("h3",{attrs:{id:"冷数据与热数据-有用数据的实时集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#冷数据与热数据-有用数据的实时集合"}},[t._v("#")]),t._v(" 冷数据与热数据 - 有用数据的实时集合")]),t._v(" "),a("ul",[a("li",[t._v("热数据，线上最新一定周期内将被反复访问的数据")]),t._v(" "),a("li",[t._v("冷数据，线上保存着的，最近不会被在线用户用到的数据")]),t._v(" "),a("li",[t._v("估算活跃用户量，数据增长量等预估热数据量")]),t._v(" "),a("li",[t._v("内存大小尽可能足够存放线上实时热数据")]),t._v(" "),a("li",[t._v("热数据相关资源：内存")])]),t._v(" "),a("h3",{attrs:{id:"线上数据分层存储-缓解线上磁盘空间压力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#线上数据分层存储-缓解线上磁盘空间压力"}},[t._v("#")]),t._v(" 线上数据分层存储 - 缓解线上磁盘空间压力")]),t._v(" "),a("ul",[a("li",[t._v("最新热数据确保放在内存中")]),t._v(" "),a("li",[t._v("还可能访问到的较早数据存放在线上库磁盘中")]),t._v(" "),a("li",[t._v("更早的不会常规访问的数据定期迁移至历史库中")]),t._v(" "),a("li",[t._v("区分哪些数据时效性强可以迁移")])]),t._v(" "),a("h3",{attrs:{id:"服务器资源选型-将可选方案列出来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器资源选型-将可选方案列出来"}},[t._v("#")]),t._v(" 服务器资源选型 - 将可选方案列出来")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("资源指标")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("可选方案")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘IO性能")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("单盘 -> 盘阵; SATA -> SAS; HDD -> SSD")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("内存容量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("较小内存 -> 较大内存")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("普通 -> 多核，超线程")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("网络吞吐量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("千兆 -> 万兆; 单网卡 -> 多路;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘容量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("单盘 -> 盘阵; 单盘 -> LVM")])])])]),t._v(" "),a("h3",{attrs:{id:"案例一-网易云音乐曲库数据库服务器评估"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例一-网易云音乐曲库数据库服务器评估"}},[t._v("#")]),t._v(" 案例一，网易云音乐曲库数据库服务器评估")]),t._v(" "),a("ul",[a("li",[t._v("用于存放线上数千万歌曲信息")]),t._v(" "),a("li",[t._v("确定属于OLTP线上类型数据库")]),t._v(" "),a("li",[t._v("并发请求量\n"),a("ul",[a("li",[t._v("50台应用服务器，每台最大连接数100")]),t._v(" "),a("li",[t._v("可能峰值5000qps，并发请求量较大")])])]),t._v(" "),a("li",[t._v("CPU需求高")]),t._v(" "),a("li",[t._v("读写比例\n"),a("ul",[a("li",[t._v("访问模式以用户列出歌单和播放歌曲时查询歌曲信息为主，用户只有只读查询")]),t._v(" "),a("li",[t._v("写数据发生在录入新歌或修改歌曲信息时后台操作，写比例小，且为批量导入")]),t._v(" "),a("li",[t._v("读写比100:1")])])]),t._v(" "),a("li",[t._v("数据总量\n"),a("ul",[a("li",[t._v("估算每首歌信息8K，总计5000万，总量400G")]),t._v(" "),a("li",[t._v("数据总量增长相对缓慢")])])]),t._v(" "),a("li",[t._v("冷热数据\n"),a("ul",[a("li",[t._v("5000万歌曲中大约40%可能被访问，10%属于热点歌曲")]),t._v(" "),a("li",[t._v("热数据大约<=40G")])])]),t._v(" "),a("li",[t._v("数据分级存储需求\n"),a("ul",[a("li",[t._v("由于没有用户产生的数据，歌曲信息无法分级存储")])])]),t._v(" "),a("li",[t._v("内存需求一般，>=40G")]),t._v(" "),a("li",[t._v("磁盘IO能力需求一般")]),t._v(" "),a("li",[t._v("网络流量要求，8k*2500/1024 ≈ 20MB/S，一般")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("资源指标")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("可选方案")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘IO性能")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("两块SAS做RAID1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("内存容量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("96G内存")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2c8core超线程 相当于32核")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("网络吞吐量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("千兆双网卡bunding")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘容量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("900G")])])])]),t._v(" "),a("h3",{attrs:{id:"案例二-网易理财销售数据库服务器评估"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例二-网易理财销售数据库服务器评估"}},[t._v("#")]),t._v(" 案例二，网易理财销售数据库服务器评估")]),t._v(" "),a("ul",[a("li",[t._v("用于存放理财用户线上订单")]),t._v(" "),a("li",[t._v("确定属于OLTP线上类型数据库")]),t._v(" "),a("li",[t._v("业务场景有明显特征\n"),a("ul",[a("li",[t._v("特定高息产品秒杀销售时间窗有大量并发订单写入")]),t._v(" "),a("li",[t._v("平时只有少量订单查询和请求，和较低的常规产品购买请求")])])]),t._v(" "),a("li",[t._v("评估应以满足最关键的业务高峰为基准")]),t._v(" "),a("li",[t._v("并发请求量\n"),a("ul",[a("li",[t._v("秒杀期间持续时间短，但是并发量预估30台应用服务器约2000tps")])])]),t._v(" "),a("li",[t._v("读写比例\n"),a("ul",[a("li",[t._v("高峰时写订单是主要开销操作")])])]),t._v(" "),a("li",[t._v("CPU要求高")]),t._v(" "),a("li",[t._v("磁盘IO要求很高")]),t._v(" "),a("li",[t._v("数据总量\n"),a("ul",[a("li",[t._v("根据业务分析，订单属于写入瞬时量大，总量较小，单笔金额较高")]),t._v(" "),a("li",[t._v("总量预估一年成交百万级别，增长较稳定")]),t._v(" "),a("li",[t._v("判断数据存储需求小于200G")])])]),t._v(" "),a("li",[t._v("冷热数据\n"),a("ul",[a("li",[t._v("峰值写入为主，内存要求存放热点期间产生的脏数据即可")])])]),t._v(" "),a("li",[t._v("数据分级存储需求\n"),a("ul",[a("li",[t._v("用户订单业务约定页面展示最近半年订单，半年前的需要到历史查询页面专门查询")]),t._v(" "),a("li",[t._v("因此可以做分级存储，迁移所有半年前的订单至历史库")])])]),t._v(" "),a("li",[t._v("内存需求一般， >= 30G")]),t._v(" "),a("li",[t._v("磁盘空间需求一般， >=200G")]),t._v(" "),a("li",[t._v("磁盘IO能力需求很高")]),t._v(" "),a("li",[t._v("网络要求较高\n"),a("ul",[a("li",[t._v("并发流量较高")]),t._v(" "),a("li",[t._v("响应速度要求高")])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("资源指标")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("可选方案")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘IO性能")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("两块SSD做RAID1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("内存容量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("64G内存")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2c8core超线程 相当于32核")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("网络吞吐量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("万兆双网卡bunding")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘容量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("600G")])])])]),t._v(" "),a("h2",{attrs:{id:"_4-4-mysql性能测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-mysql性能测试"}},[t._v("#")]),t._v(" 4.4-MySQL性能测试")]),t._v(" "),a("h3",{attrs:{id:"为什么需要性能测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要性能测试"}},[t._v("#")]),t._v(" 为什么需要性能测试")]),t._v(" "),a("ul",[a("li",[t._v("对线上产品缺乏心理预估")]),t._v(" "),a("li",[t._v("重现线上异常")]),t._v(" "),a("li",[t._v("规划未来的业务增长")]),t._v(" "),a("li",[t._v("测试不同硬件软件配置")])]),t._v(" "),a("h3",{attrs:{id:"性能测试的分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能测试的分类"}},[t._v("#")]),t._v(" 性能测试的分类")]),t._v(" "),a("ul",[a("li",[t._v("设备层的测试")]),t._v(" "),a("li",[t._v("业务层的测试")]),t._v(" "),a("li",[t._v("数据库层的测试")])]),t._v(" "),a("h3",{attrs:{id:"设备层的测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设备层的测试"}},[t._v("#")]),t._v(" 设备层的测试")]),t._v(" "),a("ul",[a("li",[t._v("关注的指标\n"),a("ul",[a("li",[t._v("服务器、磁盘性能")]),t._v(" "),a("li",[t._v("磁盘坏块率")]),t._v(" "),a("li",[t._v("服务器寿命")])])])]),t._v(" "),a("h3",{attrs:{id:"业务层测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业务层测试"}},[t._v("#")]),t._v(" 业务层测试")]),t._v(" "),a("ul",[a("li",[t._v("针对业务进行测试")])]),t._v(" "),a("h3",{attrs:{id:"数据库层测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库层测试"}},[t._v("#")]),t._v(" 数据库层测试")]),t._v(" "),a("ul",[a("li",[t._v("什么情况下要做MySQL的测试\n"),a("ul",[a("li",[t._v("测试不同的MySQL分支版本")]),t._v(" "),a("li",[t._v("测试不同的MySQL版本")]),t._v(" "),a("li",[t._v("测试不同的MySQL参数搭配")])])])]),t._v(" "),a("h3",{attrs:{id:"mysql测试分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql测试分类"}},[t._v("#")]),t._v(" MySQL测试分类")]),t._v(" "),a("ul",[a("li",[t._v("CPU Bound")]),t._v(" "),a("li",[t._v("IO Bound")])]),t._v(" "),a("p",[t._v("写入测试\n更新测试\n纯读测试\n混合模式")]),t._v(" "),a("h3",{attrs:{id:"常用的测试工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用的测试工具"}},[t._v("#")]),t._v(" 常用的测试工具")]),t._v(" "),a("ul",[a("li",[t._v("开源的MySQL性能测试工具\n"),a("ul",[a("li",[t._v("sysbench")]),t._v(" "),a("li",[t._v("tpcc-mysql")]),t._v(" "),a("li",[t._v("mysqlslap")])])]),t._v(" "),a("li",[t._v("针对业务编写性能测试工具\n"),a("ul",[a("li",[t._v("blogbench")])])])]),t._v(" "),a("h3",{attrs:{id:"性能测试衡量指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能测试衡量指标"}},[t._v("#")]),t._v(" 性能测试衡量指标")]),t._v(" "),a("ul",[a("li",[t._v("服务吞吐量(TPS, QPS)")]),t._v(" "),a("li",[t._v("服务响应时间")]),t._v(" "),a("li",[t._v("服务并发性")])]),t._v(" "),a("h3",{attrs:{id:"sysbench"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysbench"}},[t._v("#")]),t._v(" Sysbench")]),t._v(" "),a("ul",[a("li",[t._v("业界较为出名的性能测试工具")]),t._v(" "),a("li",[t._v("可以测试磁盘、CPU、数据库")]),t._v(" "),a("li",[t._v("支持多种数据库：Oracle, DB2, MySQL")]),t._v(" "),a("li",[t._v("需要自己下载编译安装")]),t._v(" "),a("li",[t._v("建议版本：sysbench0.5")])]),t._v(" "),a("h3",{attrs:{id:"编译安装sysbench"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译安装sysbench"}},[t._v("#")]),t._v(" 编译安装Sysbench")]),t._v(" "),a("ul",[a("li",[t._v("下载sysbench\n"),a("ul",[a("li",[a("code",[t._v("git clone https://github.com/akopytov/sysbench.git")])])])]),t._v(" "),a("li",[t._v("编译&安装\n"),a("ul",[a("li",[a("code",[t._v("./autogen.sh")])]),t._v(" "),a("li",[a("code",[t._v("./configure")])]),t._v(" "),a("li",[a("code",[t._v("make && make install")])])])])]),t._v(" "),a("h3",{attrs:{id:"sysbench流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysbench流程"}},[t._v("#")]),t._v(" Sysbench流程")]),t._v(" "),a("ul",[a("li",[t._v("常见的做法")])]),t._v(" "),a("p",[t._v("初始化数据 -> 运行测试 -> 清理数据")]),t._v(" "),a("h3",{attrs:{id:"prepare语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare语法"}},[t._v("#")]),t._v(" Prepare语法")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sysbench "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("parallel_prepare.lua "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--oltp_tables_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" --rand-init"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("on --oltp-table-size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500000000")]),t._v(" --mysql-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 --mysql-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" --mysql-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sys --mysql-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("netease --mysql-db"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sbtest --max-requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" prepare\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--test=parallel_prepare.lua")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("运行导数据的脚本")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--oltp_tables_count")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("测试需要几张表")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--oltp-table-size")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("每张表的大小")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--mysql-host")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL Host")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--mysql-port")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL Port")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--mysql-db")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL DB")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--mysql-user")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL User")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--mysql-password")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL Password")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--rand-init")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是否随机初始化数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--max-requests")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("执行多少个请求之后停止")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("prepare")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("执行导数据")])])])]),t._v(" "),a("h3",{attrs:{id:"sysbench表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysbench表结构"}},[t._v("#")]),t._v(" Sysbench表结构")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sbtest1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pad'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k_1'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000000001")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 MAX_ROWS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),t._v("\n")])])]),a("h3",{attrs:{id:"run语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run语法"}},[t._v("#")]),t._v(" Run语法")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sysbench "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("oltp.lua "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--oltp_tables_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" --num-threads"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" --oltp-table-size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500000000")]),t._v(" --oltp-read-only"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("off --report-interval"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" --rand-type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("uniform --mysql-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 --mysql-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" --mysql-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sys --mysql-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("netease --mysql-db"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sbtest --max-time"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" --max-requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" run\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--test=oltp.lua")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("需要运行的lua脚本")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--oltp_tables_count")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("测试需要几张表")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--oltp-table-size")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("每张表的大小")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--num-threads")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("测试并发线程数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--oltp-read-only")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是否为只读测试")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--report-interval")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("结果输出间隔")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--rand-type")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据分布模式，热点数据或者随机数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--max-time")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("最大运行时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--max-requests")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("执行多少个请求之后停止")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("prepare")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("开始测试")])])])]),t._v(" "),a("h3",{attrs:{id:"特殊情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特殊情况"}},[t._v("#")]),t._v(" 特殊情况")]),t._v(" "),a("ul",[a("li",[t._v("写入测试")])]),t._v(" "),a("p",[t._v("写入数据进行测试 -> 清理数据")]),t._v(" "),a("h3",{attrs:{id:"cleanup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cleanup"}},[t._v("#")]),t._v(" cleanup")]),t._v(" "),a("ul",[a("li",[t._v("手动drop掉表和database")]),t._v(" "),a("li",[t._v("使用sysbench提供的cleanup命令")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sysbench "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("parallel_prepare.lua "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--oltp_tables_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" --rand-init"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("on --oltp-table-size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500000000")]),t._v(" --mysql-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 --mysql-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" --mysql-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sys --mysql-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("netease --mysql-db"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sbtest --max-requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" cleanup\n")])])]),a("h3",{attrs:{id:"tpcc-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tpcc-mysql"}},[t._v("#")]),t._v(" Tpcc-mysql")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("TPC-C是专门针对联机交易处理系统(OLTP系统)的规范")])]),t._v(" "),a("li",[a("p",[t._v("Tpcc-mysql由percona根据规范实现")])]),t._v(" "),a("li",[a("p",[t._v("下载Tpcc-mysql")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("bzr branch lp:~percona-dev/perconatools/tpcc-mysql")])])])]),t._v(" "),a("li",[a("p",[t._v("编译安装")])])]),t._v(" "),a("h3",{attrs:{id:"使用tpcc-mysql的步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用tpcc-mysql的步骤"}},[t._v("#")]),t._v(" 使用Tpcc-mysql的步骤")]),t._v(" "),a("p",[t._v("创建表结构和索引 -> 导数据 -> 运行测试 -> 数据清理")]),t._v(" "),a("h3",{attrs:{id:"创建表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建表结构"}},[t._v("#")]),t._v(" 创建表结构")]),t._v(" "),a("ul",[a("li",[t._v("create_table.sql")]),t._v(" "),a("li",[t._v("add_fkey_idx.sql")])]),t._v(" "),a("h3",{attrs:{id:"tpcc-load"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tpcc-load"}},[t._v("#")]),t._v(" Tpcc-load")]),t._v(" "),a("p",[a("code",[t._v("tpcc_load [server] [DB] [user] [pass] [warehouse]")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("函数")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("server")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据库IP")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("DB")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DB名称")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("user")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("用户名")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("pass")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("密码")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("warehouse")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("仓库数量")])])])]),t._v(" "),a("h3",{attrs:{id:"tpcc-start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tpcc-start"}},[t._v("#")]),t._v(" Tpcc-start")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("tpcc_start "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v(" server_host "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-P")]),t._v(" port "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" database_name "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" mysql_user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" mysql_password "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" warehouse "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" connections "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" warmup_time "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" running_time "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" report-interval "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" report-file\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("函数")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("warehouse")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("仓库数量")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("connections")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("并发线程数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("warmup_time")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("预热时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("running_time")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("运行时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("report_interval")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输出时间间隔")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("report_file")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输出文件")])])])]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("ul",[a("li",[t._v("IO Bound测试数据量要远大于内存、CPU Bound测试数据量要小于内存")]),t._v(" "),a("li",[t._v("测试时间建议大于60分钟，减小误差")]),t._v(" "),a("li",[t._v("Sysbench更倾向于测试MySQL性能、TPCC更接近于业务")]),t._v(" "),a("li",[t._v("运行测试程序需要同时监控机器负载，MySQL各项监控指标")])])])}),[],!1,null,null,null);a.default=r.exports}}]);