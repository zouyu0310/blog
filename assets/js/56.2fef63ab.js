(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{394:function(s,t,a){s.exports=a.p+"assets/img/image-20210617192246516.cc188e28.png"},395:function(s,t,a){s.exports=a.p+"assets/img/image-20210617234848816.adfc99a5.png"},789:function(s,t,a){"use strict";a.r(t);var e=a(14),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("ul",[t("li",[t("a",{attrs:{href:"#%E7%AE%80%E4%BB%8B"}},[s._v("简介")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E5%AE%89%E8%A3%85"}},[s._v("安装")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E7%AE%80%E5%8D%95%E4%B8%8A%E6%89%8B"}},[s._v("简单上手")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#yaml-%E8%A7%84%E5%88%99"}},[s._v("yaml 规则")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#java%E6%B5%8B%E8%AF%95%E5%8F%91%E5%B8%83"}},[s._v("java测试发布")])])]),s._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("官方介绍")]),t("p",[t("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/compose/"),t("OutboundLink")],1)])]),t("p",[s._v("Compose 是一个用于定义和运行多容器 Docker 应用程序的工具。借助 Compose，您可以使用 YAML 文件来配置应用程序的服务。然后，使用单个命令，从配置中创建并启动所有服务。要了解有关 Compose 的所有功能的更多信息，请参阅"),t("a",{attrs:{href:"https://docs.docker.com/compose/#features",target:"_blank",rel:"noopener noreferrer"}},[s._v("功能列表"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("Compose 适用于所有环境：生产、登台、开发、测试以及 CI 工作流。您可以在"),t("a",{attrs:{href:"https://docs.docker.com/compose/#common-use-cases",target:"_blank",rel:"noopener noreferrer"}},[s._v("Common Use Cases 中"),t("OutboundLink")],1),s._v("了解有关每个案例的更多信息。")]),s._v(" "),t("p",[s._v("使用 Compose 基本上是一个三步过程：")]),s._v(" "),t("ol",[t("li",[s._v("使用 定义您的应用程序的环境，"),t("code",[s._v("Dockerfile")]),s._v("以便它可以在任何地方复制。")]),s._v(" "),t("li",[s._v("定义组成您的应用程序的服务，"),t("code",[s._v("docker-compose.yml")]),s._v(" 以便它们可以在隔离的环境中一起运行。")]),s._v(" "),t("li",[s._v("运行 "),t("code",[s._v("docker compose up")]),s._v(" 和  "),t("a",{attrs:{href:"https://docs.docker.com/compose/cli-command/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker compose command"),t("OutboundLink")],1),s._v(" 启动并运行你的整个应用程序。您也可以"),t("code",[s._v("docker-compose up")]),s._v("使用 docker-compose 二进制文件运行。")])]),s._v(" "),t("p",[s._v("可以用 Docker Compose 来轻松高效的管理容器。定义运行多个容器。")]),s._v(" "),t("p",[s._v("一个"),t("code",[s._v("docker-compose.yml")]),s._v("看起来像这样：")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.9"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# optional since v1.27.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5000:5000"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/code\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" logvolume01"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("logvolume01")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("1、下载")]),s._v(" "),t("p",[s._v("官网：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/local/bin/docker-compose\n")])])]),t("p",[s._v("加速下载")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/local/bin/docker-compose\n")])])]),t("p",[s._v("2、授权")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n")])])]),t("h2",{attrs:{id:"简单上手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单上手"}},[s._v("#")]),s._v(" 简单上手")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("官方文档")]),t("p",[t("a",{attrs:{href:"https://docs.docker.com/compose/gettingstarted/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/compose/gettingstarted/"),t("OutboundLink")],1)])]),t("p",[s._v("构建一个在 Docker Compose 上运行的简单 Python Web 应用程序。该应用程序使用 Flask 框架并在 Redis 中维护一个命中计数器。")]),s._v(" "),t("p",[t("strong",[s._v("第1 步：设置")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("为项目创建一个目录：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" composetest\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" composetest\n")])])])]),s._v(" "),t("li",[t("p",[s._v("创建"),t("code",[s._v("app.py")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" redis\nfrom flask "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" Flask\n\napp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis.Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ndef get_hit_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    retries "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" True:\n        try:\n            "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" cache.incr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        except redis.exceptions.ConnectionError as exc:\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" retries "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":\n                raise exc\n            retries -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            time.sleep"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n@app.route"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef hello"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_hit_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello World! I have been seen {} times.\\n'")]),s._v(".format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("在项目目录中创建 "),t("code",[s._v("requirements.txt")])])])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("flask\nredis\n")])])]),t("p",[t("strong",[s._v("第 2 步：创建 Dockerfile")])]),s._v(" "),t("p",[s._v("项目目录中，创建 "),t("code",[s._v("Dockerfile")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# syntax=docker/dockerfile:1")]),s._v("\nFROM python:3.7-alpine\nWORKDIR /code\nENV "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLASK_APP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app.py\nENV "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLASK_RUN_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nRUN apk "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --no-cache gcc musl-dev linux-headers\nCOPY requirements.txt requirements.txt\nRUN pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\nCOPY "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[t("strong",[s._v("第 3 步：在 Compose 文件中定义服务")])]),s._v(" "),t("p",[s._v("项目目录中创建 "),t("code",[s._v("docker-compose.yml")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.9"')]),s._v("\nservices:\n  web:\n    build: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5000:5000"')]),s._v("\n  redis:\n    image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis:alpine"')]),s._v("\n")])])]),t("p",[t("strong",[s._v("第 4 步：使用 Compose 构建并运行您的应用程序")])]),s._v(" "),t("p",[s._v("在项目目录中运行 "),t("code",[s._v("docker-compose up")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos composetest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose up")]),s._v("\n")])])]),t("p",[s._v("如果要后台运行")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])])]),t("p",[s._v("测试：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:5000")]),s._v("\nHello World"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" I have been seen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" times.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:5000")]),s._v("\nHello World"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" I have been seen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" times.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:5000")]),s._v("\nHello World"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" I have been seen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" times.\n")])])]),t("ul",[t("li",[s._v("名字规则")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(394),alt:"image-20210617192246516"}})]),s._v(" "),t("p",[s._v("默认的服务名：文件名_服务名 _ num")]),s._v(" "),t("ul",[t("li",[s._v("可以看见多了个网络")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network ls")]),s._v("\nNETWORK ID     NAME                  DRIVER    SCOPE\n4b873066daf7   bridge                bridge    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nd87efab51b47   composetest_default   bridge    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n86da632adad6   elastic               bridge    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n64b606f257e7   "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n34ab4fdb73c0   none                  null      "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n")])])]),t("p",[s._v("项目中的内容都在同个网络下。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("其他为演示 Compose 量身定制的示例")])]),t("p",[s._v("这些示例专门针对 Docker Compose：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/samples/django/",target:"_blank",rel:"noopener noreferrer"}},[s._v("快速入门：Compose 和 Django"),t("OutboundLink")],1),s._v(" - 展示了如何使用 Docker Compose 来设置和运行一个简单的 Django/PostgreSQL 应用程序。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/samples/rails/",target:"_blank",rel:"noopener noreferrer"}},[s._v("快速入门：Compose 和 Rails"),t("OutboundLink")],1),s._v(" - 展示了如何使用 Docker Compose 来设置和运行 Rails/PostgreSQL 应用程序。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/samples/wordpress/",target:"_blank",rel:"noopener noreferrer"}},[s._v("快速入门：Compose 和 WordPress"),t("OutboundLink")],1),s._v(" - 展示了如何使用 Docker Compose 在具有 Docker 容器的隔离环境中设置和运行 WordPress。")])]),s._v(" "),t("h2",{attrs:{id:"yaml-规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml-规则"}},[s._v("#")]),s._v(" yaml 规则")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("官方文档")]),t("p",[t("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/compose/compose-file/"),t("OutboundLink")],1)])]),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3层！")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务配置")]),s._v("\n    images\n    build\n    network\n    \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v(".\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他配置 网络/卷、全局规则")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])])]),t("h2",{attrs:{id:"java测试发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java测试发布"}},[s._v("#")]),s._v(" java测试发布")]),s._v(" "),t("p",[s._v("以上实例是用 python 写的，我们写一个 java 版本的测试下")]),s._v(" "),t("p",[t("img",{attrs:{src:a(395),alt:"image-20210617234848816"}})]),s._v(" "),t("p",[t("strong",[s._v("1、编写java代码")])]),s._v(" "),t("p",[s._v("创建一个 springboot demo")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloController")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisTemplate")]),s._v(" redisTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" views "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"views"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world! views:"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" views"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("strong",[s._v("2、添加配置")])]),s._v(" "),t("ul",[t("li",[s._v("编写 "),t("code",[s._v("application.properties")]),s._v(" 文件")])]),s._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("8080")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("spring.redis.host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("redis")]),s._v("\n")])])]),t("ul",[t("li",[s._v("编写 "),t("code",[s._v("Docker")]),s._v(" 文件")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("FROM java:8\n\nCOPY *.jar /app.jar\n\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--server.port=8080"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\nENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("编写 "),t("code",[s._v("docker-compose.yml")]),s._v(" 文件")])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.9"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zhiyuanapp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zhiyuanapp\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8080:8080"')]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"library/redis:alpine"')]),s._v("\n")])])]),t("p",[t("strong",[s._v("3、上传并构建")])]),s._v(" "),t("p",[s._v("把 jar包 、Docker、docker-compose 三个文件上传到一个目录下")]),s._v(" "),t("p",[s._v("并在此目录下构建：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos zhiyuanapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose up")]),s._v("\n")])])]),t("p",[t("strong",[s._v("4、测试：")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:8080/hello")]),s._v("\nhello world"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" views:1\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:8080/hello")]),s._v("\nhello world"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" views:2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-0-6-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:8080/hello")]),s._v("\nhello world"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" views:3\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);